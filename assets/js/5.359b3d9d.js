(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{278:function(a,s,t){a.exports=t.p+"assets/img/image-20210725160448139.0f213d06.png"},279:function(a,s,t){a.exports=t.p+"assets/img/image-20210727161152065.b51f46af.png"},578:function(a,s,t){a.exports=t.p+"assets/img/image-20210725144240631.510707ab.png"},579:function(a,s,t){a.exports=t.p+"assets/img/image-20210725144536958.97156513.png"},580:function(a,s,t){a.exports=t.p+"assets/img/image-20210725144725943.4c3fde7e.png"},581:function(a,s,t){a.exports=t.p+"assets/img/image-20210725151319695.49cc88c1.png"},582:function(a,s,t){a.exports=t.p+"assets/img/image-20210725151543640.01b3a66e.png"},583:function(a,s,t){a.exports=t.p+"assets/img/image-20210725151654046.8992d07f.png"},584:function(a,s,t){a.exports=t.p+"assets/img/image-20210725151729118.eb0f95c8.png"},585:function(a,s,t){a.exports=t.p+"assets/img/image-20210725151940515.a11230b3.png"},586:function(a,s,t){a.exports=t.p+"assets/img/image-20210725152037611.0a45c9dd.png"},587:function(a,s,t){a.exports=t.p+"assets/img/image-20210725152052501.210c8704.png"},588:function(a,s,t){a.exports=t.p+"assets/img/image-20210725152222497.933ada23.png"},589:function(a,s,t){a.exports=t.p+"assets/img/image-20210725152700914.ad99cdaa.png"},590:function(a,s,t){a.exports=t.p+"assets/img/image-20210725153201086.98d90465.png"},591:function(a,s){a.exports="data:image/png;base64,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"},592:function(a,s,t){a.exports=t.p+"assets/img/image-20210725153524190.08c2ac7a.png"},593:function(a,s,t){a.exports=t.p+"assets/img/image-20210725153715910.16e80187.png"},594:function(a,s,t){a.exports=t.p+"assets/img/image-20210725153937031.070dc2fe.png"},595:function(a,s,t){a.exports=t.p+"assets/img/image-20210725154155984.f9ceeb4a.png"},596:function(a,s,t){a.exports=t.p+"assets/img/image-20210725154216392.755eb7a3.png"},597:function(a,s,t){a.exports=t.p+"assets/img/image-20210725154405899.f1ac1b15.png"},598:function(a,s,t){a.exports=t.p+"assets/img/image-20210725154528072.23b1161f.png"},599:function(a,s,t){a.exports=t.p+"assets/img/image-20210725154632354.4a4b5bf4.png"},600:function(a,s,t){a.exports=t.p+"assets/img/image-20210725154816841.4bfdd2c2.png"},601:function(a,s,t){a.exports=t.p+"assets/img/image-20210725155019276.210c8704.png"},602:function(a,s,t){a.exports=t.p+"assets/img/image-20210725155124958.9473227d.png"},603:function(a,s,t){a.exports=t.p+"assets/img/image-20210725155747294.92e7c7ba.png"},604:function(a,s,t){a.exports=t.p+"assets/img/image-20210725155806288.210c8704.png"},605:function(a,s,t){a.exports=t.p+"assets/img/image-20210725155820320.51144ff1.png"},606:function(a,s,t){a.exports=t.p+"assets/img/image-20210725155850200.5a653e4e.png"},607:function(a,s,t){a.exports=t.p+"assets/img/image-20210725160138290.2fb33c0d.png"},608:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161007099.a9a3b202.png"},609:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161241793.95ee20af.png"},610:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161401925.869fa537.png"},611:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161506241.3c419afc.png"},612:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161540841.02fdc40a.png"},613:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161637152.07016dd1.png"},614:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161731738.17d6324b.png"},615:function(a,s,t){a.exports=t.p+"assets/img/image-20210725161817642.aff59e88.png"},616:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162030478.719a77d3.png"},617:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162101228.c67798c3.png"},618:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162145497.7ee2db4c.png"},619:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162224058.b8731c33.png"},620:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162319490.1bdce870.png"},621:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162408979.2bddafc2.png"},622:function(a,s,t){a.exports=t.p+"assets/img/image-20210727160803386.8dee0a1c.png"},623:function(a,s,t){a.exports=t.p+"assets/img/image-20210725162441407.1818cff7.png"},624:function(a,s,t){a.exports=t.p+"assets/img/image-20210727160037766.ae57ef00.png"},868:function(a,s,t){"use strict";t.r(s);var e=t(10),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"分布式缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分布式缓存"}},[a._v("#")]),a._v(" 分布式缓存")]),a._v(" "),s("p",[a._v("-- 基于Redis集群解决单机Redis存在的问题")]),a._v(" "),s("p",[a._v("单机的Redis存在四大问题：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(578),alt:"image-20210725144240631"}})]),a._v(" "),s("h1",{attrs:{id:"_0-学习目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-学习目标"}},[a._v("#")]),a._v(" 0.学习目标")]),a._v(" "),s("h1",{attrs:{id:"_1-redis持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis持久化"}},[a._v("#")]),a._v(" 1.Redis持久化")]),a._v(" "),s("p",[a._v("Redis有两种持久化方案：")]),a._v(" "),s("ul",[s("li",[a._v("RDB持久化")]),a._v(" "),s("li",[a._v("AOF持久化")])]),a._v(" "),s("h2",{attrs:{id:"_1-1-rdb持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-rdb持久化"}},[a._v("#")]),a._v(" 1.1.RDB持久化")]),a._v(" "),s("p",[a._v("RDB全称Redis Database Backup file（Redis数据备份文件），也被叫做Redis数据快照。简单来说就是把内存中的所有数据都记录到磁盘中。当Redis实例故障重启后，从磁盘读取快照文件，恢复数据。快照文件称为RDB文件，默认是保存在当前运行目录。")]),a._v(" "),s("h3",{attrs:{id:"_1-1-1-执行时机"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-执行时机"}},[a._v("#")]),a._v(" 1.1.1.执行时机")]),a._v(" "),s("p",[a._v("RDB持久化在四种情况下会执行：")]),a._v(" "),s("ul",[s("li",[a._v("执行save命令")]),a._v(" "),s("li",[a._v("执行bgsave命令")]),a._v(" "),s("li",[a._v("Redis停机时")]),a._v(" "),s("li",[a._v("触发RDB条件时")])]),a._v(" "),s("p",[s("strong",[a._v("1）save命令")])]),a._v(" "),s("p",[a._v("执行下面的命令，可以立即执行一次RDB：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(579),alt:"image-20210725144536958"}})]),a._v(" "),s("p",[a._v("save命令会导致主进程执行RDB，这个过程中其它所有命令都会被阻塞。只有在数据迁移时可能用到。")]),a._v(" "),s("p",[s("strong",[a._v("2）bgsave命令")])]),a._v(" "),s("p",[a._v("下面的命令可以异步执行RDB：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(580),alt:"image-20210725144725943"}})]),a._v(" "),s("p",[a._v("这个命令执行后会开启独立进程完成RDB，主进程可以持续处理用户请求，不受影响。")]),a._v(" "),s("p",[s("strong",[a._v("3）停机时")])]),a._v(" "),s("p",[a._v("Redis停机时会执行一次save命令，实现RDB持久化。")]),a._v(" "),s("p",[s("strong",[a._v("4）触发RDB条件")])]),a._v(" "),s("p",[a._v("Redis内部有触发RDB的机制，可以在redis.conf文件中找到，格式如下：")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# 900秒内，如果至少有1个key被修改，则执行bgsave ， 如果是save "" 则表示禁用RDB')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("save")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("900 1  ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("save")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("300 10  ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("save")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("60 10000 ")]),a._v("\n")])])]),s("p",[a._v("RDB的其它配置也可以在redis.conf文件中设置：")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是否压缩 ,建议不开启，压缩也会消耗cpu，磁盘的话不值钱")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("rdbcompression")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# RDB文件名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dbfilename")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("dump.rdb  ")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 文件保存的路径目录")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("dir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("./ ")]),a._v("\n")])])]),s("h3",{attrs:{id:"_1-1-2-rdb原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-rdb原理"}},[a._v("#")]),a._v(" 1.1.2.RDB原理")]),a._v(" "),s("p",[a._v("bgsave开始时会fork主进程得到子进程，子进程共享主进程的内存数据。完成fork后读取内存数据并写入 RDB 文件。")]),a._v(" "),s("p",[a._v("fork采用的是copy-on-write技术：")]),a._v(" "),s("ul",[s("li",[a._v("当主进程执行读操作时，访问共享内存；")]),a._v(" "),s("li",[a._v("当主进程执行写操作时，则会拷贝一份数据，执行写操作。")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(581),alt:"image-20210725151319695"}})]),a._v(" "),s("h3",{attrs:{id:"_1-1-3-小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-小结"}},[a._v("#")]),a._v(" 1.1.3.小结")]),a._v(" "),s("p",[a._v("RDB方式bgsave的基本流程？")]),a._v(" "),s("ul",[s("li",[a._v("fork主进程得到一个子进程，共享内存空间")]),a._v(" "),s("li",[a._v("子进程读取内存数据并写入新的RDB文件")]),a._v(" "),s("li",[a._v("用新RDB文件替换旧的RDB文件")])]),a._v(" "),s("p",[a._v("RDB会在什么时候执行？save 60 1000代表什么含义？")]),a._v(" "),s("ul",[s("li",[a._v("默认是服务停止时")]),a._v(" "),s("li",[a._v("代表60秒内至少执行1000次修改则触发RDB")])]),a._v(" "),s("p",[a._v("RDB的缺点？")]),a._v(" "),s("ul",[s("li",[a._v("RDB执行间隔时间长，两次RDB之间写入数据有丢失的风险")]),a._v(" "),s("li",[a._v("fork子进程、压缩、写出RDB文件都比较耗时")])]),a._v(" "),s("h2",{attrs:{id:"_1-2-aof持久化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-aof持久化"}},[a._v("#")]),a._v(" 1.2.AOF持久化")]),a._v(" "),s("h3",{attrs:{id:"_1-2-1-aof原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-aof原理"}},[a._v("#")]),a._v(" 1.2.1.AOF原理")]),a._v(" "),s("p",[a._v("AOF全称为Append Only File（追加文件）。Redis处理的每一个写命令都会记录在AOF文件，可以看做是命令日志文件。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(582),alt:"image-20210725151543640"}})]),a._v(" "),s("h3",{attrs:{id:"_1-2-2-aof配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-aof配置"}},[a._v("#")]),a._v(" 1.2.2.AOF配置")]),a._v(" "),s("p",[a._v("AOF默认是关闭的，需要修改redis.conf配置文件来开启AOF：")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 是否开启AOF功能，默认是no")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appendonly")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("yes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# AOF文件的名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appendfilename")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v('"appendonly.aof"')]),a._v("\n")])])]),s("p",[a._v("AOF的命令记录的频率也可以通过redis.conf文件来配：")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 表示每执行一次写命令，立即记录到AOF文件")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appendfsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("always ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 写命令执行完先放入AOF缓冲区，然后表示每隔1秒将缓冲区数据写到AOF文件，是默认方案")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appendfsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("everysec ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 写命令执行完先放入AOF缓冲区，由操作系统决定何时将缓冲区内容写回磁盘")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("appendfsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("no")]),a._v("\n")])])]),s("p",[a._v("三种策略对比：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(583),alt:"image-20210725151654046"}})]),a._v(" "),s("h3",{attrs:{id:"_1-2-3-aof文件重写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-aof文件重写"}},[a._v("#")]),a._v(" 1.2.3.AOF文件重写")]),a._v(" "),s("p",[a._v("因为是记录命令，AOF文件会比RDB文件大的多。而且AOF会记录对同一个key的多次写操作，但只有最后一次写操作才有意义。通过执行bgrewriteaof命令，可以让AOF文件执行重写功能，用最少的命令达到相同效果。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(584),alt:"image-20210725151729118"}})]),a._v(" "),s("p",[a._v("如图，AOF原本有三个命令，但是"),s("code",[a._v("set num 123 和 set num 666")]),a._v("都是对num的操作，第二次会覆盖第一次的值，因此第一个命令记录下来没有意义。")]),a._v(" "),s("p",[a._v("所以重写命令后，AOF文件内容就是："),s("code",[a._v("mset name jack num 666")])]),a._v(" "),s("p",[a._v("Redis也会在触发阈值时自动去重写AOF文件。阈值也可以在redis.conf中配置：")]),a._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# AOF文件比上次文件 增长超过多少百分比则触发重写")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("auto-aof-rewrite-percentage")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("100")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# AOF文件体积最小多大以上才触发重写 ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("auto-aof-rewrite-min-size")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("64mb ")]),a._v("\n")])])]),s("h2",{attrs:{id:"_1-3-rdb与aof对比"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-rdb与aof对比"}},[a._v("#")]),a._v(" 1.3.RDB与AOF对比")]),a._v(" "),s("p",[a._v("RDB和AOF各有自己的优缺点，如果对数据安全性要求较高，在实际开发中往往会"),s("strong",[a._v("结合")]),a._v("两者来使用。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(585),alt:"image-20210725151940515"}})]),a._v(" "),s("h1",{attrs:{id:"_2-redis主从"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-redis主从"}},[a._v("#")]),a._v(" 2.Redis主从")]),a._v(" "),s("h2",{attrs:{id:"_2-1-搭建主从架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-搭建主从架构"}},[a._v("#")]),a._v(" 2.1.搭建主从架构")]),a._v(" "),s("p",[a._v("单节点Redis的并发能力是有上限的，要进一步提高Redis的并发能力，就需要搭建主从集群，实现读写分离。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(586),alt:"image-20210725152037611"}})]),a._v(" "),s("p",[a._v("具体搭建流程参考课前资料《Redis集群.md》：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(587),alt:"image-20210725152052501"}})]),a._v(" "),s("h2",{attrs:{id:"_2-2-主从数据同步原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-主从数据同步原理"}},[a._v("#")]),a._v(" 2.2.主从数据同步原理")]),a._v(" "),s("h3",{attrs:{id:"_2-2-1-全量同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-全量同步"}},[a._v("#")]),a._v(" 2.2.1.全量同步")]),a._v(" "),s("p",[a._v("主从第一次建立连接时，会执行"),s("strong",[a._v("全量同步")]),a._v("，将master节点的所有数据都拷贝给slave节点，流程：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(588),alt:"image-20210725152222497"}})]),a._v(" "),s("p",[a._v("这里有一个问题，master如何得知salve是第一次来连接呢？？")]),a._v(" "),s("p",[a._v("有几个概念，可以作为判断依据：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("Replication Id")]),a._v("：简称replid，是数据集的标记，id一致则说明是同一数据集。每一个master都有唯一的replid，slave则会继承master节点的replid")]),a._v(" "),s("li",[s("strong",[a._v("offset")]),a._v("：偏移量，随着记录在repl_baklog中的数据增多而逐渐增大。slave完成同步时也会记录当前同步的offset。如果slave的offset小于master的offset，说明slave数据落后于master，需要更新。")])]),a._v(" "),s("p",[a._v("因此slave做数据同步，必须向master声明自己的replication id 和offset，master才可以判断到底需要同步哪些数据。")]),a._v(" "),s("p",[a._v("因为slave原本也是一个master，有自己的replid和offset，当第一次变成slave，与master建立连接时，发送的replid和offset是自己的replid和offset。")]),a._v(" "),s("p",[a._v("master判断发现slave发送来的replid与自己的不一致，说明这是一个全新的slave，就知道要做全量同步了。")]),a._v(" "),s("p",[a._v("master会将自己的replid和offset都发送给这个slave，slave保存这些信息。以后slave的replid就与master一致了。")]),a._v(" "),s("p",[a._v("因此，"),s("strong",[a._v("master判断一个节点是否是第一次同步的依据，就是看replid是否一致")]),a._v("。")]),a._v(" "),s("p",[a._v("如图：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(589),alt:"image-20210725152700914"}})]),a._v(" "),s("p",[a._v("完整流程描述：")]),a._v(" "),s("ul",[s("li",[a._v("slave节点请求增量同步")]),a._v(" "),s("li",[a._v("master节点判断replid，发现不一致，拒绝增量同步")]),a._v(" "),s("li",[a._v("master将完整内存数据生成RDB，发送RDB到slave")]),a._v(" "),s("li",[a._v("slave清空本地数据，加载master的RDB")]),a._v(" "),s("li",[a._v("master将RDB期间的命令记录在repl_baklog，并持续将log中的命令发送给slave")]),a._v(" "),s("li",[a._v("slave执行接收到的命令，保持与master之间的同步")])]),a._v(" "),s("h3",{attrs:{id:"_2-2-2-增量同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-增量同步"}},[a._v("#")]),a._v(" 2.2.2.增量同步")]),a._v(" "),s("p",[a._v("全量同步需要先做RDB，然后将RDB文件通过网络传输个slave，成本太高了。因此除了第一次做全量同步，其它大多数时候slave与master都是做"),s("strong",[a._v("增量同步")]),a._v("。")]),a._v(" "),s("p",[a._v("什么是增量同步？就是只更新slave与master存在差异的部分数据。如图：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(590),alt:"image-20210725153201086"}})]),a._v(" "),s("p",[a._v("那么master怎么知道slave与自己的数据差异在哪里呢?")]),a._v(" "),s("h3",{attrs:{id:"_2-2-3-repl-backlog原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-repl-backlog原理"}},[a._v("#")]),a._v(" 2.2.3.repl_backlog原理")]),a._v(" "),s("p",[a._v("master怎么知道slave与自己的数据差异在哪里呢?")]),a._v(" "),s("p",[a._v("这就要说到全量同步时的repl_baklog文件了。")]),a._v(" "),s("p",[a._v("这个文件是一个固定大小的数组，只不过数组是环形，也就是说"),s("strong",[a._v("角标到达数组末尾后，会再次从0开始读写")]),a._v("，这样数组头部的数据就会被覆盖。")]),a._v(" "),s("p",[a._v("repl_baklog中会记录Redis处理过的命令日志及offset，包括master当前的offset，和slave已经拷贝到的offset：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(591),alt:"image-20210725153359022"}})]),a._v(" "),s("p",[a._v("slave与master的offset之间的差异，就是salve需要增量拷贝的数据了。")]),a._v(" "),s("p",[a._v("随着不断有数据写入，master的offset逐渐变大，slave也不断的拷贝，追赶master的offset：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(592),alt:"image-20210725153524190"}})]),a._v(" "),s("p",[a._v("直到数组被填满：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(593),alt:"image-20210725153715910"}})]),a._v(" "),s("p",[a._v("此时，如果有新的数据写入，就会覆盖数组中的旧数据。不过，旧的数据只要是绿色的，说明是已经被同步到slave的数据，即便被覆盖了也没什么影响。因为未同步的仅仅是红色部分。")]),a._v(" "),s("p",[a._v("但是，如果slave出现网络阻塞，导致master的offset远远超过了slave的offset：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(594),alt:"image-20210725153937031"}})]),a._v(" "),s("p",[a._v("如果master继续写入新数据，其offset就会覆盖旧的数据，直到将slave现在的offset也覆盖：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(595),alt:"image-20210725154155984"}})]),a._v(" "),s("p",[a._v("棕色框中的红色部分，就是尚未同步，但是却已经被覆盖的数据。此时如果slave恢复，需要同步，却发现自己的offset都没有了，无法完成增量同步了。只能做全量同步。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(596),alt:"image-20210725154216392"}})]),a._v(" "),s("h2",{attrs:{id:"_2-3-主从同步优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-主从同步优化"}},[a._v("#")]),a._v(" 2.3.主从同步优化")]),a._v(" "),s("p",[a._v("主从同步可以保证主从数据的一致性，非常重要。")]),a._v(" "),s("p",[a._v("可以从以下几个方面来优化Redis主从就集群：")]),a._v(" "),s("ul",[s("li",[a._v("在master中配置repl-diskless-sync yes启用无磁盘复制，避免全量同步时的磁盘IO。")]),a._v(" "),s("li",[a._v("Redis单节点上的内存占用不要太大，减少RDB导致的过多磁盘IO")]),a._v(" "),s("li",[a._v("适当提高repl_baklog的大小，发现slave宕机时尽快实现故障恢复，尽可能避免全量同步")]),a._v(" "),s("li",[a._v("限制一个master上的slave节点数量，如果实在是太多slave，则可以采用主-从-从链式结构，减少master压力")])]),a._v(" "),s("p",[a._v("主从从架构图：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(597),alt:"image-20210725154405899"}})]),a._v(" "),s("h2",{attrs:{id:"_2-4-小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-小结"}},[a._v("#")]),a._v(" 2.4.小结")]),a._v(" "),s("p",[a._v("简述全量同步和增量同步区别？")]),a._v(" "),s("ul",[s("li",[a._v("全量同步：master将完整内存数据生成RDB，发送RDB到slave。后续命令则记录在repl_baklog，逐个发送给slave。")]),a._v(" "),s("li",[a._v("增量同步：slave提交自己的offset到master，master获取repl_baklog中从offset之后的命令给slave")])]),a._v(" "),s("p",[a._v("什么时候执行全量同步？")]),a._v(" "),s("ul",[s("li",[a._v("slave节点第一次连接master节点时")]),a._v(" "),s("li",[a._v("slave节点断开时间太久，repl_baklog中的offset已经被覆盖时")])]),a._v(" "),s("p",[a._v("什么时候执行增量同步？")]),a._v(" "),s("ul",[s("li",[a._v("slave节点断开又恢复，并且在repl_baklog中能找到offset时")])]),a._v(" "),s("h1",{attrs:{id:"_3-redis哨兵"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-redis哨兵"}},[a._v("#")]),a._v(" 3.Redis哨兵")]),a._v(" "),s("p",[a._v("Redis提供了哨兵（Sentinel）机制来实现主从集群的自动故障恢复。")]),a._v(" "),s("h2",{attrs:{id:"_3-1-哨兵原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-哨兵原理"}},[a._v("#")]),a._v(" 3.1.哨兵原理")]),a._v(" "),s("h3",{attrs:{id:"_3-1-1-集群结构和作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-集群结构和作用"}},[a._v("#")]),a._v(" 3.1.1.集群结构和作用")]),a._v(" "),s("p",[a._v("哨兵的结构如图：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(598),alt:"image-20210725154528072"}})]),a._v(" "),s("p",[a._v("哨兵的作用如下：")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("监控")]),a._v("：Sentinel 会不断检查您的master和slave是否按预期工作")]),a._v(" "),s("li",[s("strong",[a._v("自动故障恢复")]),a._v("：如果master故障，Sentinel会将一个slave提升为master。当故障实例恢复后也以新的master为主")]),a._v(" "),s("li",[s("strong",[a._v("通知")]),a._v("：Sentinel充当Redis客户端的服务发现来源，当集群发生故障转移时，会将最新信息推送给Redis的客户端")])]),a._v(" "),s("h3",{attrs:{id:"_3-1-2-集群监控原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-集群监控原理"}},[a._v("#")]),a._v(" 3.1.2.集群监控原理")]),a._v(" "),s("p",[a._v("Sentinel基于心跳机制监测服务状态，每隔1秒向集群的每个实例发送ping命令：")]),a._v(" "),s("p",[a._v("•主观下线：如果某sentinel节点发现某实例未在规定时间响应，则认为该实例"),s("strong",[a._v("主观下线")]),a._v("。")]),a._v(" "),s("p",[a._v("•客观下线：若超过指定数量（quorum）的sentinel都认为该实例主观下线，则该实例"),s("strong",[a._v("客观下线")]),a._v("。quorum值最好超过Sentinel实例数量的一半。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(599),alt:"image-20210725154632354"}})]),a._v(" "),s("h3",{attrs:{id:"_3-1-3-集群故障恢复原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-集群故障恢复原理"}},[a._v("#")]),a._v(" 3.1.3.集群故障恢复原理")]),a._v(" "),s("p",[a._v("一旦发现master故障，sentinel需要在salve中选择一个作为新的master，选择依据是这样的：")]),a._v(" "),s("ul",[s("li",[a._v("首先会判断slave节点与master节点断开时间长短，如果超过指定值（down-after-milliseconds * 10）则会排除该slave节点")]),a._v(" "),s("li",[a._v("然后判断slave节点的slave-priority值，越小优先级越高，如果是0则永不参与选举")]),a._v(" "),s("li",[a._v("如果slave-prority一样，则判断slave节点的offset值，越大说明数据越新，优先级越高")]),a._v(" "),s("li",[a._v("最后是判断slave节点的运行id大小，越小优先级越高。")])]),a._v(" "),s("p",[a._v("当选出一个新的master后，该如何实现切换呢？")]),a._v(" "),s("p",[a._v("流程如下：")]),a._v(" "),s("ul",[s("li",[a._v("sentinel给备选的slave1节点发送slaveof no one命令，让该节点成为master")]),a._v(" "),s("li",[a._v("sentinel给所有其它slave发送slaveof 192.168.150.101 7002 命令，让这些slave成为新master的从节点，开始从新的master上同步数据。")]),a._v(" "),s("li",[a._v("最后，sentinel将故障节点标记为slave，当故障节点恢复后会自动成为新的master的slave节点")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(600),alt:"image-20210725154816841"}})]),a._v(" "),s("h3",{attrs:{id:"_3-1-4-小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-小结"}},[a._v("#")]),a._v(" 3.1.4.小结")]),a._v(" "),s("p",[a._v("Sentinel的三个作用是什么？")]),a._v(" "),s("ul",[s("li",[a._v("监控")]),a._v(" "),s("li",[a._v("故障转移")]),a._v(" "),s("li",[a._v("通知")])]),a._v(" "),s("p",[a._v("Sentinel如何判断一个redis实例是否健康？")]),a._v(" "),s("ul",[s("li",[a._v("每隔1秒发送一次ping命令，如果超过一定时间没有相向则认为是主观下线")]),a._v(" "),s("li",[a._v("如果大多数sentinel都认为实例主观下线，则判定服务下线")])]),a._v(" "),s("p",[a._v("故障转移步骤有哪些？")]),a._v(" "),s("ul",[s("li",[a._v("首先选定一个slave作为新的master，执行slaveof no one")]),a._v(" "),s("li",[a._v("然后让所有节点都执行slaveof 新master")]),a._v(" "),s("li",[a._v("修改故障节点配置，添加slaveof 新master")])]),a._v(" "),s("h2",{attrs:{id:"_3-2-搭建哨兵集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-搭建哨兵集群"}},[a._v("#")]),a._v(" 3.2.搭建哨兵集群")]),a._v(" "),s("p",[a._v("具体搭建流程参考课前资料《Redis集群.md》：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(601),alt:"image-20210725155019276"}})]),a._v(" "),s("h2",{attrs:{id:"_3-3-redistemplate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-redistemplate"}},[a._v("#")]),a._v(" 3.3.RedisTemplate")]),a._v(" "),s("p",[a._v("在Sentinel集群监管下的Redis主从集群，其节点会因为自动故障转移而发生变化，Redis的客户端必须感知这种变化，及时更新连接信息。Spring的RedisTemplate底层利用lettuce实现了节点的感知和自动切换。")]),a._v(" "),s("p",[a._v("下面，我们通过一个测试来实现RedisTemplate集成哨兵机制。")]),a._v(" "),s("h3",{attrs:{id:"_3-3-1-导入demo工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-导入demo工程"}},[a._v("#")]),a._v(" 3.3.1.导入Demo工程")]),a._v(" "),s("p",[a._v("首先，我们引入课前资料提供的Demo工程：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(602),alt:"image-20210725155124958"}})]),a._v(" "),s("h3",{attrs:{id:"_3-3-2-引入依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-引入依赖"}},[a._v("#")]),a._v(" 3.3.2.引入依赖")]),a._v(" "),s("p",[a._v("在项目的pom文件中引入依赖：")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-boot-starter-data-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),s("h3",{attrs:{id:"_3-3-3-配置redis地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-配置redis地址"}},[a._v("#")]),a._v(" 3.3.3.配置Redis地址")]),a._v(" "),s("p",[a._v("然后在配置文件application.yml中指定redis的sentinel相关信息：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("spring"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n  redis"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n    sentinel"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n      master"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" mymaster\n      nodes"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".150")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".101")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27001")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".150")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".101")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27002")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".150")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v(".101")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27003")]),a._v("\n")])])]),s("h3",{attrs:{id:"_3-3-4-配置读写分离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-配置读写分离"}},[a._v("#")]),a._v(" 3.3.4.配置读写分离")]),a._v(" "),s("p",[a._v("在项目的启动类中，添加一个新的bean：")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Bean")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("LettuceClientConfigurationBuilderCustomizer")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("clientConfigurationBuilderCustomizer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" clientConfigurationBuilder "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" clientConfigurationBuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("readFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ReadFrom")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("REPLICA_PREFERRED")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("p",[a._v("这个bean中配置的就是读写策略，包括四种：")]),a._v(" "),s("ul",[s("li",[a._v("MASTER：从主节点读取")]),a._v(" "),s("li",[a._v("MASTER_PREFERRED：优先从master节点读取，master不可用才读取replica")]),a._v(" "),s("li",[a._v("REPLICA：从slave（replica）节点读取")]),a._v(" "),s("li",[a._v("REPLICA _PREFERRED：优先从slave（replica）节点读取，所有的slave都不可用才读取master")])]),a._v(" "),s("h1",{attrs:{id:"_4-redis分片集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-redis分片集群"}},[a._v("#")]),a._v(" 4.Redis分片集群")]),a._v(" "),s("h2",{attrs:{id:"_4-1-搭建分片集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-搭建分片集群"}},[a._v("#")]),a._v(" 4.1.搭建分片集群")]),a._v(" "),s("p",[a._v("主从和哨兵可以解决高可用、高并发读的问题。但是依然有两个问题没有解决：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("海量数据存储问题")])]),a._v(" "),s("li",[s("p",[a._v("高并发写的问题")])])]),a._v(" "),s("p",[a._v("使用分片集群可以解决上述问题，如图:")]),a._v(" "),s("p",[s("img",{attrs:{src:t(603),alt:"image-20210725155747294"}})]),a._v(" "),s("p",[a._v("分片集群特征：")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("集群中有多个master，每个master保存不同数据")])]),a._v(" "),s("li",[s("p",[a._v("每个master都可以有多个slave节点")])]),a._v(" "),s("li",[s("p",[a._v("master之间通过ping监测彼此健康状态")])]),a._v(" "),s("li",[s("p",[a._v("客户端请求可以访问集群任意节点，最终都会被转发到正确节点")])])]),a._v(" "),s("p",[a._v("具体搭建流程参考课前资料《Redis集群.md》：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(604),alt:"image-20210725155806288"}})]),a._v(" "),s("h2",{attrs:{id:"_4-2-散列插槽"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-散列插槽"}},[a._v("#")]),a._v(" 4.2.散列插槽")]),a._v(" "),s("h3",{attrs:{id:"_4-2-1-插槽原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-插槽原理"}},[a._v("#")]),a._v(" 4.2.1.插槽原理")]),a._v(" "),s("p",[a._v("Redis会把每一个master节点映射到0~16383共16384个插槽（hash slot）上，查看集群信息时就能看到：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(605),alt:"image-20210725155820320"}})]),a._v(" "),s("p",[a._v("数据key不是与节点绑定，而是与插槽绑定。redis会根据key的有效部分计算插槽值，分两种情况：")]),a._v(" "),s("ul",[s("li",[a._v('key中包含"{}"，且“{}”中至少包含1个字符，“{}”中的部分是有效部分')]),a._v(" "),s("li",[a._v("key中不包含“{}”，整个key都是有效部分")])]),a._v(" "),s("p",[a._v("例如：key是num，那么就根据num计算，如果是{itcast}num，则根据itcast计算。计算方式是利用CRC16算法得到一个hash值，然后对16384取余，得到的结果就是slot值。")]),a._v(" "),s("p",[s("img",{attrs:{src:t(606),alt:"image-20210725155850200"}})]),a._v(" "),s("p",[a._v("如图，在7001这个节点执行set a 1时，对a做hash运算，对16384取余，得到的结果是15495，因此要存储到103节点。")]),a._v(" "),s("p",[a._v("到了7003后，执行"),s("code",[a._v("get num")]),a._v("时，对num做hash运算，对16384取余，得到的结果是2765，因此需要切换到7001节点")]),a._v(" "),s("h3",{attrs:{id:"_4-2-1-小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-小结"}},[a._v("#")]),a._v(" 4.2.1.小结")]),a._v(" "),s("p",[a._v("Redis如何判断某个key应该在哪个实例？")]),a._v(" "),s("ul",[s("li",[a._v("将16384个插槽分配到不同的实例")]),a._v(" "),s("li",[a._v("根据key的有效部分计算哈希值，对16384取余")]),a._v(" "),s("li",[a._v("余数作为插槽，寻找插槽所在实例即可")])]),a._v(" "),s("p",[a._v("如何将同一类数据固定的保存在同一个Redis实例？")]),a._v(" "),s("ul",[s("li",[a._v("这一类数据使用相同的有效部分，例如key都以{typeId}为前缀")])]),a._v(" "),s("h2",{attrs:{id:"_4-3-集群伸缩"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-集群伸缩"}},[a._v("#")]),a._v(" 4.3.集群伸缩")]),a._v(" "),s("p",[a._v("redis-cli --cluster提供了很多操作集群的命令，可以通过下面方式查看：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(607),alt:"image-20210725160138290"}})]),a._v(" "),s("p",[a._v("比如，添加节点的命令：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(278),alt:"image-20210725160448139"}})]),a._v(" "),s("h3",{attrs:{id:"_4-3-1-需求分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-需求分析"}},[a._v("#")]),a._v(" 4.3.1.需求分析")]),a._v(" "),s("p",[a._v("需求：向集群中添加一个新的master节点，并向其中存储 num = 10")]),a._v(" "),s("ul",[s("li",[a._v("启动一个新的redis实例，端口为7004")]),a._v(" "),s("li",[a._v("添加7004到之前的集群，并作为一个master节点")]),a._v(" "),s("li",[a._v("给7004节点分配插槽，使得num这个key可以存储到7004实例")])]),a._v(" "),s("p",[a._v("这里需要两个新的功能：")]),a._v(" "),s("ul",[s("li",[a._v("添加一个节点到集群中")]),a._v(" "),s("li",[a._v("将部分插槽分配到新插槽")])]),a._v(" "),s("h3",{attrs:{id:"_4-3-2-创建新的redis实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-创建新的redis实例"}},[a._v("#")]),a._v(" 4.3.2.创建新的redis实例")]),a._v(" "),s("p",[a._v("创建一个文件夹：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7004")]),a._v("\n")])])]),s("p",[a._v("拷贝配置文件：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" redis.conf /7004\n")])])]),s("p",[a._v("修改配置文件：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sed")]),a._v(" /s/6379/7004/g "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7004")]),a._v("/redis.conf\n")])])]),s("p",[a._v("启动")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("redis-server "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7004")]),a._v("/redis.conf\n")])])]),s("h3",{attrs:{id:"_4-3-3-添加新节点到redis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-添加新节点到redis"}},[a._v("#")]),a._v(" 4.3.3.添加新节点到redis")]),a._v(" "),s("p",[a._v("添加节点的语法如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(278),alt:"image-20210725160448139"}})]),a._v(" "),s("p",[a._v("执行命令：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("redis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--cluster")]),a._v(" add-node  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".150.101:7004 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".150.101:7001\n")])])]),s("p",[a._v("通过命令查看集群状态：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("redis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7001")]),a._v(" cluster nodes\n")])])]),s("p",[a._v("如图，7004加入了集群，并且默认是一个master节点：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(608),alt:"image-20210725161007099"}})]),a._v(" "),s("p",[a._v("但是，可以看到7004节点的插槽数量为0，因此没有任何数据可以存储到7004上")]),a._v(" "),s("h3",{attrs:{id:"_4-3-4-转移插槽"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-转移插槽"}},[a._v("#")]),a._v(" 4.3.4.转移插槽")]),a._v(" "),s("p",[a._v("我们要将num存储到7004节点，因此需要先看看num的插槽是多少：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(609),alt:"image-20210725161241793"}})]),a._v(" "),s("p",[a._v("如上图所示，num的插槽为2765.")]),a._v(" "),s("p",[a._v("我们可以将0~3000的插槽从7001转移到7004，命令格式如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(610),alt:"image-20210725161401925"}})]),a._v(" "),s("p",[a._v("具体命令如下：")]),a._v(" "),s("p",[a._v("建立连接：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(611),alt:"image-20210725161506241"}})]),a._v(" "),s("p",[a._v("得到下面的反馈：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(612),alt:"image-20210725161540841"}})]),a._v(" "),s("p",[a._v("询问要移动多少个插槽，我们计划是3000个：")]),a._v(" "),s("p",[a._v("新的问题来了：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(613),alt:"image-20210725161637152"}})]),a._v(" "),s("p",[a._v("那个node来接收这些插槽？？")]),a._v(" "),s("p",[a._v("显然是7004，那么7004节点的id是多少呢？")]),a._v(" "),s("p",[s("img",{attrs:{src:t(614),alt:"image-20210725161731738"}})]),a._v(" "),s("p",[a._v("复制这个id，然后拷贝到刚才的控制台后：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(615),alt:"image-20210725161817642"}})]),a._v(" "),s("p",[a._v("这里询问，你的插槽是从哪里移动过来的？")]),a._v(" "),s("ul",[s("li",[a._v("all：代表全部，也就是三个节点各转移一部分")]),a._v(" "),s("li",[a._v("具体的id：目标节点的id")]),a._v(" "),s("li",[a._v("done：没有了")])]),a._v(" "),s("p",[a._v("这里我们要从7001获取，因此填写7001的id：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(616),alt:"image-20210725162030478"}})]),a._v(" "),s("p",[a._v("填完后，点击done，这样插槽转移就准备好了：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(617),alt:"image-20210725162101228"}})]),a._v(" "),s("p",[a._v("确认要转移吗？输入yes：")]),a._v(" "),s("p",[a._v("然后，通过命令查看结果：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(618),alt:"image-20210725162145497"}})]),a._v(" "),s("p",[a._v("可以看到：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(619),alt:"image-20210725162224058"}})]),a._v(" "),s("p",[a._v("目的达成。")]),a._v(" "),s("h2",{attrs:{id:"_4-4-故障转移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-故障转移"}},[a._v("#")]),a._v(" 4.4.故障转移")]),a._v(" "),s("p",[a._v("集群初识状态是这样的：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(279),alt:"image-20210727161152065"}})]),a._v(" "),s("p",[a._v("其中7001、7002、7003都是master，我们计划让7002宕机。")]),a._v(" "),s("h3",{attrs:{id:"_4-4-1-自动故障转移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-自动故障转移"}},[a._v("#")]),a._v(" 4.4.1.自动故障转移")]),a._v(" "),s("p",[a._v("当集群中有一个master宕机会发生什么呢？")]),a._v(" "),s("p",[a._v("直接停止一个redis实例，例如7002：")]),a._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[a._v("redis-cli "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7002")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("shutdown")]),a._v("\n")])])]),s("p",[a._v("1）首先是该实例与其它实例失去连接")]),a._v(" "),s("p",[a._v("2）然后是疑似宕机：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(620),alt:"image-20210725162319490"}})]),a._v(" "),s("p",[a._v("3）最后是确定下线，自动提升一个slave为新的master：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(621),alt:"image-20210725162408979"}})]),a._v(" "),s("p",[a._v("4）当7002再次启动，就会变为一个slave节点了：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(622),alt:"image-20210727160803386"}})]),a._v(" "),s("h3",{attrs:{id:"_4-4-2-手动故障转移"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-手动故障转移"}},[a._v("#")]),a._v(" 4.4.2.手动故障转移")]),a._v(" "),s("p",[a._v("利用cluster failover命令可以手动让集群中的某个master宕机，切换到执行cluster failover命令的这个slave节点，实现无感知的数据迁移。其流程如下：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(623),alt:"image-20210725162441407"}})]),a._v(" "),s("p",[a._v("这种failover命令可以指定三种模式：")]),a._v(" "),s("ul",[s("li",[a._v("缺省：默认的流程，如图1~6歩")]),a._v(" "),s("li",[a._v("force：省略了对offset的一致性校验")]),a._v(" "),s("li",[a._v("takeover：直接执行第5歩，忽略数据一致性、忽略master状态和其它master的意见")])]),a._v(" "),s("p",[s("strong",[a._v("案例需求")]),a._v("：在7002这个slave节点执行手动故障转移，重新夺回master地位")]),a._v(" "),s("p",[a._v("步骤如下：")]),a._v(" "),s("p",[a._v("1）利用redis-cli连接7002这个节点")]),a._v(" "),s("p",[a._v("2）执行cluster failover命令")]),a._v(" "),s("p",[a._v("如图：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(624),alt:"image-20210727160037766"}})]),a._v(" "),s("p",[a._v("效果：")]),a._v(" "),s("p",[s("img",{attrs:{src:t(279),alt:"image-20210727161152065"}})]),a._v(" "),s("h2",{attrs:{id:"_4-5-redistemplate访问分片集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-redistemplate访问分片集群"}},[a._v("#")]),a._v(" 4.5.RedisTemplate访问分片集群")]),a._v(" "),s("p",[a._v("RedisTemplate底层同样基于lettuce实现了分片集群的支持，而使用的步骤与哨兵模式基本一致：")]),a._v(" "),s("p",[a._v("1）引入redis的starter依赖")]),a._v(" "),s("p",[a._v("2）配置分片集群地址")]),a._v(" "),s("p",[a._v("3）配置读写分离")]),a._v(" "),s("p",[a._v("与哨兵模式相比，其中只有分片集群的配置方式略有差异，如下：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nodes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7001")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7002")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("7003")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8001")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8002")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8003")]),a._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);