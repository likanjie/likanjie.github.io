(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{623:function(s,t){s.exports="data:image/png;base64,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"},624:function(s,t,a){s.exports=a.p+"assets/img/image-20210629114830642.cc3d38b5.png"},625:function(s,t,a){s.exports=a.p+"assets/img/image-20210629114941810.3cc0bc31.png"},626:function(s,t,a){s.exports=a.p+"assets/img/image-20210630111505799.3d5d3a92.png"},627:function(s,t,a){s.exports=a.p+"assets/img/image-20210630113929868.4d44682c.png"},628:function(s,t,a){s.exports=a.p+"assets/img/image-20210630183914491.41cda412.png"},629:function(s,t,a){s.exports=a.p+"assets/img/image-20210630201258802.9a1fa413.png"},630:function(s,t,a){s.exports=a.p+"assets/img/image-20210701215227018.5f85e3d1.png"},631:function(s,t,a){s.exports=a.p+"assets/img/image-20210701215534714.dfeea7c9.png"},632:function(s,t,a){s.exports=a.p+"assets/img/image-20210701220714104.7eb3bfe8.png"},633:function(s,t,a){s.exports=a.p+"assets/img/image-20210701222857997.ec790b1a.png"},634:function(s,t,a){s.exports=a.p+"assets/img/image-20210701223025709.9a304997.png"},635:function(s,t,a){s.exports=a.p+"assets/img/image-20210701223131264.cb7dd0a2.png"},636:function(s,t,a){s.exports=a.p+"assets/img/image-20210702164116027.87286816.png"},637:function(s,t,a){s.exports=a.p+"assets/img/image-20210702174255799.5eff1160.png"},638:function(s,t,a){s.exports=a.p+"assets/img/image-20210702181101969.2ca044ec.png"},639:function(s,t,a){s.exports=a.p+"assets/img/image-20210702181215705.201a1e22.png"},640:function(s,t,a){s.exports=a.p+"assets/img/image-20210702181922809.e97f6f66.png"},641:function(s,t,a){s.exports=a.p+"assets/img/image-20210702182343979.0e77f5bd.png"},642:function(s,t,a){s.exports=a.p+"assets/img/image-20210702182602145.856ed505.png"},870:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis集群"}},[s._v("#")]),s._v(" Redis集群")]),s._v(" "),t("p",[s._v("本章是基于CentOS7下的Redis集群教程，包括：")]),s._v(" "),t("ul",[t("li",[s._v("单机安装Redis")]),s._v(" "),t("li",[s._v("Redis主从")]),s._v(" "),t("li",[s._v("Redis分片集群")])]),s._v(" "),t("h1",{attrs:{id:"_1-单机安装redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-单机安装redis"}},[s._v("#")]),s._v(" 1.单机安装Redis")]),s._v(" "),t("p",[s._v("首先需要安装Redis所需要的依赖：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" gcc tcl\n")])])]),t("p",[s._v("然后将课前资料提供的Redis安装包上传到虚拟机的任意目录：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(623),alt:"image-20210629114325516"}})]),s._v(" "),t("p",[s._v("例如，我放到了/tmp目录：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(624),alt:"image-20210629114830642"}})]),s._v(" "),t("p",[s._v("解压缩：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xzf")]),s._v(" redis-6.2.4.tar.gz\n")])])]),t("p",[s._v("解压后：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(625),alt:"image-20210629114941810"}})]),s._v(" "),t("p",[s._v("进入redis目录：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" redis-6.2.4\n")])])]),t("p",[s._v("运行编译命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])])]),t("p",[s._v("如果没有出错，应该就安装成功了。")]),s._v(" "),t("p",[s._v("然后修改redis.conf文件中的一些配置：")]),s._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定地址，默认是127.0.0.1，会导致只能在本地访问。修改为0.0.0.0则可以在任意IP访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("0.0.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保护模式，关闭保护模式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("protected-mode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("no")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库数量，设置为1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("databases")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("启动Redis：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-server redis.conf\n")])])]),t("p",[s._v("停止redis服务：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),t("h1",{attrs:{id:"_2-redis主从集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-redis主从集群"}},[s._v("#")]),s._v(" 2.Redis主从集群")]),s._v(" "),t("h2",{attrs:{id:"_2-1-集群结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-集群结构"}},[s._v("#")]),s._v(" 2.1.集群结构")]),s._v(" "),t("p",[s._v("我们搭建的主从集群结构如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(626),alt:"image-20210630111505799"}})]),s._v(" "),t("p",[s._v("共包含三个节点，一个主节点，两个从节点。")]),s._v(" "),t("p",[s._v("这里我们会在同一台虚拟机中开启3个redis实例，模拟主从集群，信息如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("IP")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("PORT")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("角色")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("7001")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("master")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("7002")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("slave")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("7003")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("slave")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-2-准备实例和配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-准备实例和配置"}},[s._v("#")]),s._v(" 2.2.准备实例和配置")]),s._v(" "),t("p",[s._v("要在同一台虚拟机开启3个实例，必须准备三份不同的配置文件和目录，配置文件所在目录也就是工作目录。")]),s._v(" "),t("p",[s._v("1）创建目录")]),s._v(" "),t("p",[s._v("我们创建三个文件夹，名字分别叫7001、7002、7003：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n")])])]),t("p",[s._v("如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(627),alt:"image-20210630113929868"}})]),s._v(" "),t("p",[s._v("2）恢复原始配置")]),s._v(" "),t("p",[s._v("修改redis-6.2.4/redis.conf文件，将其中的持久化模式改为默认的RDB模式，AOF保持关闭状态。")]),s._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启RDB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# save ""')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("save")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("3600 1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("save")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("300 100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("save")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("60 10000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭AOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("appendonly")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("no")]),s._v("\n")])])]),t("p",[s._v("3）拷贝配置文件到每个实例目录")]),s._v(" "),t("p",[s._v("然后将redis-6.2.4/redis.conf文件拷贝到三个目录中（在/tmp目录执行下列命令）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式一：逐个拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis-6.2.4/redis.conf "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis-6.2.4/redis.conf "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis-6.2.4/redis.conf "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式二：管道组合命令，一键拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis-6.2.4/redis.conf\n")])])]),t("p",[s._v("4）修改每个实例的端口、工作目录")]),s._v(" "),t("p",[s._v("修改每个文件夹内的配置文件，将端口分别修改为7001、7002、7003，将rdb文件保存位置都修改为自己所在目录（在/tmp目录执行下列命令）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/6379/7001/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/dir .\\//dir \\/tmp\\/7001\\//g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("/redis.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/6379/7002/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/dir .\\//dir \\/tmp\\/7002\\//g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("/redis.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/6379/7003/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/dir .\\//dir \\/tmp\\/7003\\//g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("/redis.conf\n")])])]),t("p",[s._v("5）修改每个实例的声明IP")]),s._v(" "),t("p",[s._v("虚拟机本身有多个IP，为了避免将来混乱，我们需要在redis.conf文件中指定每一个实例的绑定ip信息，格式如下：")]),s._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis实例的声明 IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("replica-announce-ip")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("192.168.150.101")]),s._v("\n")])])]),t("p",[s._v("每个目录都要改，我们一键完成修改（在/tmp目录执行下列命令）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 逐一执行")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1a replica-announce-ip 192.168.150.101'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("/redis.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1a replica-announce-ip 192.168.150.101'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("/redis.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1a replica-announce-ip 192.168.150.101'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("/redis.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者一键修改")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s\\n'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" -I"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1a replica-announce-ip 192.168.150.101'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/redis.conf\n")])])]),t("h2",{attrs:{id:"_2-3-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-启动"}},[s._v("#")]),s._v(" 2.3.启动")]),s._v(" "),t("p",[s._v("为了方便查看日志，我们打开3个ssh窗口，分别启动3个redis实例，启动命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第1个")]),s._v("\nredis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("/redis.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第2个")]),s._v("\nredis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("/redis.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第3个")]),s._v("\nredis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("/redis.conf\n")])])]),t("p",[s._v("启动后：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(628),alt:"image-20210630183914491"}})]),s._v(" "),t("p",[s._v("如果要一键停止，可以运行下面命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s\\n'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" -I"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),t("h2",{attrs:{id:"_2-4-开启主从关系"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-开启主从关系"}},[s._v("#")]),s._v(" 2.4.开启主从关系")]),s._v(" "),t("p",[s._v("现在三个实例还没有任何关系，要配置主从可以使用replicaof 或者slaveof（5.0以前）命令。")]),s._v(" "),t("p",[s._v("有临时和永久两种模式：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("修改配置文件（永久生效）")]),s._v(" "),t("ul",[t("li",[s._v("在redis.conf中添加一行配置："),t("code",[s._v("slaveof <masterip> <masterport>")])])])]),s._v(" "),t("li",[t("p",[s._v("使用redis-cli客户端连接到redis服务，执行slaveof命令（重启后失效）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("slaveof "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("masterport"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])])]),s._v(" "),t("p",[t("strong",[t("font",{attrs:{color:"red"}},[s._v("注意")])],1),s._v("：在5.0以后新增命令replicaof，与salveof效果一致。")]),s._v(" "),t("p",[s._v("这里我们为了演示方便，使用方式二。")]),s._v(" "),t("p",[s._v("通过redis-cli命令连接7002，执行下面命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接 7002")]),s._v("\nredis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行slaveof")]),s._v("\nslaveof "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n")])])]),t("p",[s._v("通过redis-cli命令连接7003，执行下面命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接 7003")]),s._v("\nredis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行slaveof")]),s._v("\nslaveof "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n")])])]),t("p",[s._v("然后连接 7001节点，查看集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接 7001")]),s._v("\nredis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\ninfo replication\n")])])]),t("p",[s._v("结果：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(629),alt:"image-20210630201258802"}})]),s._v(" "),t("h2",{attrs:{id:"_2-5-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-测试"}},[s._v("#")]),s._v(" 2.5.测试")]),s._v(" "),t("p",[s._v("执行下列操作以测试：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("利用redis-cli连接7001，执行"),t("code",[s._v("set num 123")])])]),s._v(" "),t("li",[t("p",[s._v("利用redis-cli连接7002，执行"),t("code",[s._v("get num")]),s._v("，再执行"),t("code",[s._v("set num 666")])])]),s._v(" "),t("li",[t("p",[s._v("利用redis-cli连接7003，执行"),t("code",[s._v("get num")]),s._v("，再执行"),t("code",[s._v("set num 888")])])])]),s._v(" "),t("p",[s._v("可以发现，只有在7001这个master节点上可以执行写操作，7002和7003这两个slave节点只能执行读操作。")]),s._v(" "),t("h1",{attrs:{id:"_3-搭建哨兵集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-搭建哨兵集群"}},[s._v("#")]),s._v(" 3.搭建哨兵集群")]),s._v(" "),t("h2",{attrs:{id:"_3-1-集群结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-集群结构"}},[s._v("#")]),s._v(" 3.1.集群结构")]),s._v(" "),t("p",[s._v("这里我们搭建一个三节点形成的Sentinel集群，来监管之前的Redis主从集群。如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(630),alt:"image-20210701215227018"}})]),s._v(" "),t("p",[s._v("三个sentinel实例信息如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("节点")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("IP")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("PORT")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("s1")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("27001")])]),s._v(" "),t("tr",[t("td",[s._v("s2")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("27002")])]),s._v(" "),t("tr",[t("td",[s._v("s3")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("27003")])])])]),s._v(" "),t("h2",{attrs:{id:"_3-2-准备实例和配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-准备实例和配置"}},[s._v("#")]),s._v(" 3.2.准备实例和配置")]),s._v(" "),t("p",[s._v("要在同一台虚拟机开启3个实例，必须准备三份不同的配置文件和目录，配置文件所在目录也就是工作目录。")]),s._v(" "),t("p",[s._v("我们创建三个文件夹，名字分别叫s1、s2、s3：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" s1 s2 s3\n")])])]),t("p",[s._v("如图：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(631),alt:"image-20210701215534714"}})]),s._v(" "),t("p",[s._v("然后我们在s1目录创建一个sentinel.conf文件，添加下面的内容：")]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[s._v('port 27001\nsentinel announce-ip 192.168.150.101\nsentinel monitor mymaster 192.168.150.101 7001 2\nsentinel down-after-milliseconds mymaster 5000\nsentinel failover-timeout mymaster 60000\ndir "/tmp/s1"\n')])])]),t("p",[s._v("解读：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("port 27001")]),s._v("：是当前sentinel实例的端口")]),s._v(" "),t("li",[t("code",[s._v("sentinel monitor mymaster 192.168.150.101 7001 2")]),s._v("：指定主节点信息\n"),t("ul",[t("li",[t("code",[s._v("mymaster")]),s._v("：主节点名称，自定义，任意写")]),s._v(" "),t("li",[t("code",[s._v("192.168.150.101 7001")]),s._v("：主节点的ip和端口")]),s._v(" "),t("li",[t("code",[s._v("2")]),s._v("：选举master时的quorum值")])])])]),s._v(" "),t("p",[s._v("然后将s1/sentinel.conf文件拷贝到s2、s3两个目录中（在/tmp目录执行下列命令）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式一：逐个拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" s1/sentinel.conf s2\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" s1/sentinel.conf s3\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方式二：管道组合命令，一键拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" s2 s3 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" s1/sentinel.conf\n")])])]),t("p",[s._v("修改s2、s3两个文件夹内的配置文件，将端口分别修改为27002、27003：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/27001/27002/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/s1/s2/g'")]),s._v(" s2/sentinel.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/27001/27003/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/s1/s3/g'")]),s._v(" s3/sentinel.conf\n")])])]),t("h2",{attrs:{id:"_3-3-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-启动"}},[s._v("#")]),s._v(" 3.3.启动")]),s._v(" "),t("p",[s._v("为了方便查看日志，我们打开3个ssh窗口，分别启动3个redis实例，启动命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第1个")]),s._v("\nredis-sentinel s1/sentinel.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第2个")]),s._v("\nredis-sentinel s2/sentinel.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第3个")]),s._v("\nredis-sentinel s3/sentinel.conf\n")])])]),t("p",[s._v("启动后：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(632),alt:"image-20210701220714104"}})]),s._v(" "),t("h2",{attrs:{id:"_3-4-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-测试"}},[s._v("#")]),s._v(" 3.4.测试")]),s._v(" "),t("p",[s._v("尝试让master节点7001宕机，查看sentinel日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(633),alt:"image-20210701222857997"}})]),s._v(" "),t("p",[s._v("查看7003的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(634),alt:"image-20210701223025709"}})]),s._v(" "),t("p",[s._v("查看7002的日志：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(635),alt:"image-20210701223131264"}})]),s._v(" "),t("h1",{attrs:{id:"_4-搭建分片集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-搭建分片集群"}},[s._v("#")]),s._v(" 4.搭建分片集群")]),s._v(" "),t("h2",{attrs:{id:"_4-1-集群结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-集群结构"}},[s._v("#")]),s._v(" 4.1.集群结构")]),s._v(" "),t("p",[s._v("分片集群需要的节点数量较多，这里我们搭建一个最小的分片集群，包含3个master节点，每个master包含一个slave节点，结构如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(636),alt:"image-20210702164116027"}})]),s._v(" "),t("p",[s._v("这里我们会在同一台虚拟机中开启6个redis实例，模拟分片集群，信息如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("IP")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("PORT")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("角色")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("7001")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("master")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("7002")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("master")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("7003")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("master")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("8001")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("slave")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("8002")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("slave")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("192.168.150.101")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("8003")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("slave")])])])]),s._v(" "),t("h2",{attrs:{id:"_4-2-准备实例和配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-准备实例和配置"}},[s._v("#")]),s._v(" 4.2.准备实例和配置")]),s._v(" "),t("p",[s._v("删除之前的7001、7002、7003这几个目录，重新创建出7001、7002、7003、8001、8002、8003目录：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除旧的，避免配置干扰")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8003")]),s._v("\n")])])]),t("p",[s._v("在/tmp下准备一个新的redis.conf文件，内容如下：")]),s._v(" "),t("div",{staticClass:"language-ini extra-class"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[s._v("port 6379\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启集群功能")]),s._v("\ncluster-enabled yes\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群的配置文件名称，不需要我们创建，由redis自己维护")]),s._v("\ncluster-config-file /tmp/6379/nodes.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 节点心跳失败的超时时间")]),s._v("\ncluster-node-timeout 5000\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 持久化文件存放目录")]),s._v("\ndir /tmp/6379\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 绑定地址")]),s._v("\nbind 0.0.0.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让redis后台运行")]),s._v("\ndaemonize yes\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注册的实例ip")]),s._v("\nreplica-announce-ip 192.168.150.101\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保护模式")]),s._v("\nprotected-mode no\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据库数量")]),s._v("\ndatabases 1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志")]),s._v("\nlogfile /tmp/6379/run.log\n")])])]),t("p",[s._v("将这个文件拷贝到每个目录下：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行拷贝")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" redis.conf\n")])])]),t("p",[s._v("修改每个目录下的redis.conf，将其中的6379修改为与所在目录一致：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s\\n'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" -I"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/6379/{}/g'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/redis.conf\n")])])]),t("h2",{attrs:{id:"_4-3-启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-启动"}},[s._v("#")]),s._v(" 4.3.启动")]),s._v(" "),t("p",[s._v("因为已经配置了后台启动模式，所以可以直接启动服务：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入/tmp目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一键启动所有服务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s\\n'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" -I"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" redis-server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/redis.conf\n")])])]),t("p",[s._v("通过ps查看状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n")])])]),t("p",[s._v("发现服务都已经正常启动：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(637),alt:"image-20210702174255799"}})]),s._v(" "),t("p",[s._v("如果要关闭所有进程，可以执行命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v("\n")])])]),t("p",[s._v("或者（推荐这种方式）：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("printf")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%s\\n'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8002")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8003")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" -I"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("shutdown")]),s._v("\n")])])]),t("h2",{attrs:{id:"_4-4-创建集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-创建集群"}},[s._v("#")]),s._v(" 4.4.创建集群")]),s._v(" "),t("p",[s._v("虽然服务启动了，但是目前每个服务之间都是独立的，没有任何关联。")]),s._v(" "),t("p",[s._v("我们需要执行命令来创建集群，在Redis5.0之前创建集群比较麻烦，5.0之后集群管理命令都集成到了redis-cli中。")]),s._v(" "),t("p",[s._v("1）Redis5.0之前")]),s._v(" "),t("p",[s._v("Redis5.0之前集群命令都是用redis安装包下的src/redis-trib.rb来实现的。因为redis-trib.rb是有ruby语言编写的所以需要安装ruby环境。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" zlib ruby rubygems\ngem "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" redis\n")])])]),t("p",[s._v("然后通过命令来管理集群：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入redis的src目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /tmp/redis-6.2.4/src\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建集群")]),s._v("\n./redis-trib.rb create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7001 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7002 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7003 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8001 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8002 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8003\n")])])]),t("p",[s._v("2）Redis5.0以后")]),s._v(" "),t("p",[s._v("我们使用的是Redis6.2.4版本，集群管理以及集成到了redis-cli中，格式如下：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--cluster")]),s._v(" create --cluster-replicas "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7001 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7002 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:7003 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8001 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8002 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".150.101:8003\n")])])]),t("p",[s._v("命令说明：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("redis-cli --cluster")]),s._v("或者"),t("code",[s._v("./redis-trib.rb")]),s._v("：代表集群操作命令")]),s._v(" "),t("li",[t("code",[s._v("create")]),s._v("：代表是创建集群")]),s._v(" "),t("li",[t("code",[s._v("--replicas 1")]),s._v("或者"),t("code",[s._v("--cluster-replicas 1")]),s._v(" ：指定集群中每个master的副本个数为1，此时"),t("code",[s._v("节点总数 ÷ (replicas + 1)")]),s._v(" 得到的就是master的数量。因此节点列表中的前n个就是master，其它节点都是slave节点，随机分配到不同master")])]),s._v(" "),t("p",[s._v("运行后的样子：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(638),alt:"image-20210702181101969"}})]),s._v(" "),t("p",[s._v("这里输入yes，则集群开始创建：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(639),alt:"image-20210702181215705"}})]),s._v(" "),t("p",[s._v("通过命令可以查看集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v(" cluster nodes\n")])])]),t("p",[t("img",{attrs:{src:a(640),alt:"image-20210702181922809"}})]),s._v(" "),t("h2",{attrs:{id:"_4-5-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-测试"}},[s._v("#")]),s._v(" 4.5.测试")]),s._v(" "),t("p",[s._v("尝试连接7001节点，存储一个数据：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接")]),s._v("\nredis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储数据")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" num "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取数据")]),s._v("\nget num\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再次存储")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),t("p",[s._v("结果悲剧了：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(641),alt:"image-20210702182343979"}})]),s._v(" "),t("p",[s._v("集群操作时，需要给"),t("code",[s._v("redis-cli")]),s._v("加上"),t("code",[s._v("-c")]),s._v("参数才可以：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7001")]),s._v("\n")])])]),t("p",[s._v("这次可以了：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(642),alt:"image-20210702182602145"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);