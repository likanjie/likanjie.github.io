(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{472:function(e,n){e.exports="data:image/png;base64,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"},473:function(e,n,t){e.exports=t.p+"assets/img/2.e153f47c.png"},474:function(e,n,t){e.exports=t.p+"assets/img/3.f7cc7534.png"},475:function(e,n,t){e.exports=t.p+"assets/img/4.9bbe4111.png"},476:function(e,n,t){e.exports=t.p+"assets/img/5.a07d6c7f.png"},477:function(e,n,t){e.exports=t.p+"assets/img/6.c9f87ca0.png"},478:function(e,n,t){e.exports=t.p+"assets/img/7.409f73a1.png"},479:function(e,n,t){e.exports=t.p+"assets/img/8.ee86ba71.png"},480:function(e,n,t){e.exports=t.p+"assets/img/9.b50635cb.png"},862:function(e,n,t){"use strict";t.r(n);var s=t(10),i=Object(s.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h2",{attrs:{id:"redis-官方的高可用解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-官方的高可用解决方案"}},[e._v("#")]),e._v(" Redis 官方的高可用解决方案")]),e._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[e._v("来源")]),e._v(" "),n("p",[e._v("作者：须臾之余"),n("br"),e._v("\nhttps://my.oschina.net/u/3995125/blog/3133204")])]),e._v(" "),n("h4",{attrs:{id:"redis主从复制的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis主从复制的问题"}},[e._v("#")]),e._v(" Redis主从复制的问题")]),e._v(" "),n("p",[n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247513229&idx=2&sn=20ed0053a17942bd273a1cc0729a7b59&chksm=e918d191de6f588792a01fbe3d98cc9812e8cbe3f862ce334bbf91e057199859c8e63bd414d4&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis"),n("OutboundLink")],1),e._v(" 主从复制可将主节点数据同步给从节点，从节点此时有两个作用：")]),e._v(" "),n("ul",[n("li",[e._v("一旦主节点宕机，从节点作为主节点的备份可以随时顶上来。")]),e._v(" "),n("li",[e._v("扩展主节点的读能力，分担主节点读压力。")])]),e._v(" "),n("p",[n("img",{attrs:{src:t(472),alt:"图片"}})]),e._v(" "),n("p",[n("strong",[e._v("主从复制同时存在以下几个问题")]),e._v("：")]),e._v(" "),n("ul",[n("li",[e._v("一旦主节点宕机，从节点晋升成主节点，同时需要修改应用方的主节点地址，还需要命令所有 从节点去复制新的主节点，整个过程需要人工干预。")]),e._v(" "),n("li",[e._v("主节点的写能力受到单机的限制。")]),e._v(" "),n("li",[e._v("主节点的存储能力受到单机的限制。")]),e._v(" "),n("li",[e._v("原生复制的弊端在早期的版本中也会比较突出，比如："),n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247508806&idx=2&sn=82eef6b17ab3f10f1da48be91807534b&chksm=e918c65ade6f4f4c75a1a4a14d8f2b10e901b8e641c1b543e24c902b8a874beca8fb832149e5&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis "),n("OutboundLink")],1),e._v("复制中断后，从节点会发起 psync。此时如果同步不成功，则会进行全量同步，主库执行全量备份的同时，可能会造成毫秒或秒级的卡顿。")]),e._v(" "),n("li",[e._v("在民工哥技术之路公众号后台回复关键字 Redis手册 免费获取一份redis最佳实践与实战指南电子书")])]),e._v(" "),n("h4",{attrs:{id:"redis-的-哨兵-sentinel-深入探究"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-的-哨兵-sentinel-深入探究"}},[e._v("#")]),e._v(" Redis 的 哨兵（Sentinel）深入探究")]),e._v(" "),n("h5",{attrs:{id:"redis-sentinel的架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-sentinel的架构"}},[e._v("#")]),e._v(" "),n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247506691&idx=2&sn=45645ef63701a94ec5d71273322a75b9&chksm=e918be1fde6f3709eaa33d9706c1e803b7816e3158f5c642fe949230094e4142d4dbc6528d0a&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis"),n("OutboundLink")],1),e._v(" Sentinel的架构")]),e._v(" "),n("p",[n("img",{attrs:{src:t(473),alt:"图片"}})]),e._v(" "),n("p",[n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247505422&idx=2&sn=ce618a2cd611564dddfacadc948ab75c&chksm=e918b312de6f3a0452f8e5e188464103b471cf4a2d8083889a71acd3059430da99253c266b26&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis"),n("OutboundLink")],1),e._v("的哨兵机制就是解决我们以上主从复制存在缺陷（选举问题），保证我们的Redis高可用，实现自动化故障发现与故障转移。")]),e._v(" "),n("p",[e._v("该系统执行以下三个任务：")]),e._v(" "),n("ul",[n("li",[n("strong",[e._v("监控")]),e._v("：哨兵会不断检查你的主服务器和从服务器是否运作正常。")]),e._v(" "),n("li",[n("strong",[e._v("提醒")]),e._v("：当被监控的某个"),n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247505737&idx=2&sn=40cd237449349cc7d59b166263b262a1&chksm=e918b255de6f3b43e2c57d62aaae334ab8deb79af983510e25222f0bd42c3ae62cd96a2d3082&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis服务器"),n("OutboundLink")],1),e._v("出现问题时，哨兵可以通过API给程序员发送通知")]),e._v(" "),n("li",[n("strong",[e._v("自动故障转移")]),e._v("：主服务器宕机，哨兵会开始一次自动故障转移操作，升级一个从服务器为主服务器，并让其他从服务器改为复制新的主服务器.")])]),e._v(" "),n("h4",{attrs:{id:"配置-sentinel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-sentinel"}},[e._v("#")]),e._v(" 配置 Sentinel")]),e._v(" "),n("p",[n("a",{attrs:{href:"http://mp.weixin.qq.com/s?__biz=MzI0MDQ4MTM5NQ==&mid=2247504617&idx=2&sn=8ab5b6e42a944d86257119b1eb295378&chksm=e918b7f5de6f3ee31d717d19e97c9233ce7094c85450ca3c649087fe37e0840fd2a8b63b89fe&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"}},[e._v("Redis "),n("OutboundLink")],1),e._v("源码中包含了一个名为 sentinel.conf 的文件， 这个文件是一个带有详细注释的 Sentinel 配置文件示例。")]),e._v(" "),n("p",[e._v("运行一个 Sentinel 所需的最少配置如下所示：")]),e._v(" "),n("div",{staticClass:"language-text extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('1）sentinel monitor mymaster 192.168.10.202 6379 2\n\nSentine监听的maste地址，第一个参数是给master起的名字，第二个参数为master IP，第三个为master端口，第四个为当该master挂了的时候，若想将该master判为失效，\n\n在Sentine集群中必须至少2个Sentine同意才行，只要该数量不达标，则就不会发生故障迁移。\n\n2）sentinel down-after-milliseconds mymaster 30000\n\n表示master被当前sentinel实例认定为失效的间隔时间，在这段时间内一直没有给Sentine返回有效信息，则认定该master主观下线。\n\n只有在足够数量的 Sentinel 都将一个服务器标记为主观下线之后， 服务器才会被标记为客观下线，将服务器标记为客观下线所需的 Sentinel 数量由对主服务器的配置决定。\n\n3）sentinel parallel-syncs mymaster 2\n\n当在执行故障转移时，设置几个slave同时进行切换master，该值越大，则可能就有越多的slave在切换master时不可用，可以将该值设置为1，即一个一个来，这样在某个\n\nslave进行切换master同步数据时，其余的slave还能正常工作，以此保证每次只有一个从服务器处于不能处理命令请求的状态。\n\n4）sentinel can-failover mymaster yes\n\n在sentinel检测到O_DOWN后，是否对这台redis启动failover机制\n\n5）sentinel auth-pass mymaster 20180408\n\n设置sentinel连接的master和slave的密码，这个需要和redis.conf文件中设置的密码一样\n\n6）sentinel failover-timeout mymaster 180000\n\nfailover过期时间，当failover开始后，在此时间内仍然没有触发任何failover操作，当前sentinel将会认为此次failoer失败。 \n\n执行故障迁移超时时间，即在指定时间内没有大多数的sentinel 反馈master下线，该故障迁移计划则失效\n\n7）sentinel config-epoch mymaster 0\n\n选项指定了在执行故障转移时， 最多可以有多少个从服务器同时对新的主服务器进行同步。这个数字越小， 完成故障转移所需的时间就越长。\n\n8）sentinel notification-script mymaster /var/redis/notify.sh\n\n当failover时，可以指定一个"通知"脚本用来告知当前集群的情况。\n\n脚本被允许执行的最大时间为60秒，如果超时，脚本将会被终止(KILL)\n\n\n9）sentinel leader-epoch mymaster 0\n\n同时一时间最多0个slave可同时更新配置,建议数字不要太大,以免影响正常对外提供服务。\n')])])]),n("h6",{attrs:{id:"主观下线和客观下线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主观下线和客观下线"}},[e._v("#")]),e._v(" 主观下线和客观下线")]),e._v(" "),n("ul",[n("li",[e._v("主观下线：指的是单个 Sentinel 实例对服务器做出的下线判断。")]),e._v(" "),n("li",[e._v("客观下线：指的是多个 Sentinel 实例在对同一个服务器做出SDOWN主观下线判断。")])]),e._v(" "),n("h4",{attrs:{id:"redis-sentinel的工作原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#redis-sentinel的工作原理"}},[e._v("#")]),e._v(" Redis Sentinel的工作原理")]),e._v(" "),n("p",[e._v("1.每个 Sentinel 以"),n("strong",[e._v("每秒一次")]),e._v("的频率向它所知的主服务器、从服务器以及其他 Sentinel 实例"),n("strong",[e._v("发送一个 PING 命令")]),e._v("。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(474),alt:"图片"}})]),e._v(" "),n("p",[e._v("2.如果一个实例距离最后一次有效回复 PING 命令的"),n("strong",[e._v("时间超过指定的值")]),e._v("， 那么这个实例会"),n("strong",[e._v("被 Sentinel 标记为主观下线")]),e._v("。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(475),alt:"图片"}})]),e._v(" "),n("p",[e._v("3.正在监视这个主服务器的所有 Sentinel 要以"),n("strong",[e._v("每秒一次")]),e._v("的频率确认主服务器的确进入了"),n("strong",[e._v("主观下线状态")]),e._v("。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(476),alt:"图片"}})]),e._v(" "),n("p",[e._v("4.有足够数量的 Sentinel 在指定的时间范围内同意这一判断， 那么这个"),n("strong",[e._v("主服务器被标记为客观下线")]),e._v("。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(477),alt:"图片"}})]),e._v(" "),n("p",[e._v("5.每个 Sentinel 会以每 10 秒一次的频率向它已知的所有主服务器和从服务器发送 INFO 命令。当一个主服务器被 Sentinel 标记为客观下线时， Sentinel 向下线主服务器的所有从服务器发送 INFO 命令的频率会"),n("strong",[e._v("从 10 秒一次改为每秒一")]),e._v("次。在民工哥技术之路公众号后台回复关键字 Redis手册 免费获取一份redis最佳实践与实战指南电子书。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(478),alt:"图片"}})]),e._v(" "),n("p",[e._v("6.Sentinel 和其他 Sentinel 协商主节点的状态，如果"),n("strong",[e._v("主节点处于 SDOWN 状态")]),e._v("，则投票"),n("strong",[e._v("自动选出新的主节点")]),e._v("。将剩余的"),n("strong",[e._v("从节点")]),e._v("指"),n("strong",[e._v("向新的主节点进行数据复制")]),e._v("。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(479),alt:"图片"}})]),e._v(" "),n("p",[e._v("7.当没有足够数量的 Sentinel 同意主服务器 下线时， 主服务器的客观下线状态就会被移除。当主服务器重新向 Sentinel 的 PING 命令返回有效回复时，主服务器的主观下线状态就会被移除。")]),e._v(" "),n("p",[n("img",{attrs:{src:t(480),alt:"图片"}})]),e._v(" "),n("h2",{attrs:{id:"自动发现-sentinel-和从服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自动发现-sentinel-和从服务器"}},[e._v("#")]),e._v(" 自动发现 Sentinel 和从服务器")]),e._v(" "),n("p",[n("strong",[e._v("一个 Sentinel 可以与其他多个 Sentinel 进行连接， 各个 Sentinel 之间可以互相检查对方的可用性，并进行信息交换")]),e._v("。")]),e._v(" "),n("p",[e._v("你无须为运行的每个 Sentinel 分别设置其他 Sentinel 的地址，因为 Sentinel 可以"),n("strong",[e._v("通过发布与订阅功能")]),e._v("来自动发现正在"),n("strong",[e._v("监视相同主服务器的其他 Sentinel")]),e._v("。")]),e._v(" "),n("ul",[n("li",[e._v("每个 Sentinel 会以每两秒一次的频率，通过发布与订阅功能，向被它监视的所有主服务器和从服务器的频道发送一条信息，信息中包含了 Sentinel 的 IP 地址、端口号和运行 ID （runid）。")]),e._v(" "),n("li",[e._v("每个 Sentinel 都订阅了被它监视的所有主服务器和从服务器的频道， 查找之前未出现过的 sentinel 。当一个 Sentinel 发现一个新的 Sentinel 时， 它会将新的 Sentinel 添加到一个列表中。")]),e._v(" "),n("li",[e._v("Sentinel 发送的信息中还包括完整的主服务器当前配置。如果一个 Sentinel 包含的主服务器配置比另一个 Sentinel 发送的配置要旧， 那么这个 Sentinel 会立即升级到新配置上。")]),e._v(" "),n("li",[e._v("在将一个新 Sentinel 添加到监视主服务器的列表上面之前， Sentinel 会先检查列表中是否已经包含了和要添加的 Sentinel 拥有相同运行 ID 或者相同地址（包括 IP 地址和端口号）的 Sentinel ， 如果是的话， Sentinel 会先移除列表中已有的那些拥有相同运行 ID 或者相同地址的 Sentinel ， 然后再添加新 Sentinel")])]),e._v(" "),n("h2",{attrs:{id:"故障转移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#故障转移"}},[e._v("#")]),e._v(" 故障转移")]),e._v(" "),n("p",[e._v("一次故障转移操作由以下步骤组成：")]),e._v(" "),n("ul",[n("li",[e._v("发现主服务器已经进入客观下线状态。")]),e._v(" "),n("li",[e._v("对我们的当前纪元进行自增， 并尝试在这个纪元中当选。")]),e._v(" "),n("li",[e._v("如果当选失败， 那么在设定的故障迁移超时时间的两倍之后， 重新尝试当选。如果当选成功， 那么执行以下步骤。")]),e._v(" "),n("li",[e._v("选出一个从服务器，并将它升级为主服务器。")]),e._v(" "),n("li",[e._v("向被选中的从服务器发送 SLAVEOF NO ONE 命令，让它转变为主服务器。")]),e._v(" "),n("li",[e._v("通过发布与订阅功能， 将更新后的配置传播给所有其他 Sentinel ， 其他 Sentinel 对它们自己的配置进行更新。")]),e._v(" "),n("li",[e._v("向已下线主服务器的从服务器发送 SLAVEOF 命令， 让它们去复制新的主服务器。")]),e._v(" "),n("li",[e._v("当所有从服务器都已经开始复制新的主服务器时， 领头 Sentinel 终止这次故障迁移操作。")])])])}),[],!1,null,null,null);n.default=i.exports}}]);