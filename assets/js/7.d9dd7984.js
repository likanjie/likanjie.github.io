(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{645:function(t,s,a){t.exports=a.p+"assets/img/image-20210821075259137.b634641b.png"},646:function(t,s,a){t.exports=a.p+"assets/img/image-20210821075558137.15db1bbb.png"},647:function(t,s,a){t.exports=a.p+"assets/img/image-20210821080511581.efcb989d.png"},648:function(t,s,a){t.exports=a.p+"assets/img/image-20210821080954947.d6750c17.png"},649:function(t,s){t.exports="data:image/png;base64,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"},650:function(t,s,a){t.exports=a.p+"assets/img/image-20210821081826399.31f119fe.png"},651:function(t,s,a){t.exports=a.p+"assets/img/image-20210821091437975.eac7f556.png"},652:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqsAAABiCAYAAAB3Y5qkAAAZdUlEQVR4nO3dzWsb574H8K8lJzE5f8BdiAqJFmNKFyYL04VbrozJ6LaLC9fFGGNOSXHi0+KdDCf19WIWumkO2DvDaRxzTIIJxiQX7qKpZIx1Sb0oWgQvQjCiRYOKFvcPOMGv0l3MPONnRjOSRq8j5fsB4UR5NC/WxPr6eX7PMwPlcrkMIiIiIiIfCnT7AIiIiIiI3DCsEhEREZFvMawSERERkW8xrBIRERGRbzGsEhEREZFvDbZiI24LCnChASIiIqL+NzAw4Ol5LxoKqyKEymHU7c/VniMiIiKi3uQUROXnBgYGzPwnnm8kvA7Uu86qPaDKX93+zf5aIiIiIuof9vBpD6UDAwOOzzm91k1dPav2QOr2d4ZWIiIiov5Xb0i1h1W311VTM6xWC6elUsk1rNYqFSAiIiKi3mQf7hdf3cJqIOA+p79WYK0aVu1B1P6Qw6o9uMqvF38mIiIiov5QK6QGAoGqAdZpW05cw2qtgFoqlSyPekOr+DsRERER9RZ7j2qtkBoIBBAIBFAul83n3XpZ3QKrY1h1CppOIfXy8tIxtFYrD5C/EhEREVHvqFWbKgdS+REMBs3AKl4n/9m+aoCsIqzae0CdelFFUBUPe3h1C6wMq0RERES9yy2k2oNqMBisCKriqxxaRa+r2K78Z6Fqz6p9+N8eUv/lX+fa+f0gIiIioj7wf/+7bQZWQfSoyp2YdfWsAu49qiKkXlxc4PLysg2nQkRERET95uLiomJkXQ6mckmAnSWsVluiSoTVi4sL80FEREREVMv5+XlFD6p4iLzpVrtaswzAafj/4uIC5+fnbT4tIiIiIuoHIjc61braA6ud4wQre1h1CqpnZ2ftPzMiIiIi6nkiN7pNzJKzZ9UJVm6TqsRDLgFgzyoRERER1eP8/NxcHUAEVDljyr2r9sBa12oA9slVrFklIiIionpdXFxYlrO6vLys6FF1W9rUdZ3VaisCNNWzOp1EWR2zPZnF0sgy1qrcN5aoZUoKDo4TiNmezqiTmNjlNUhERNRq5+fnCAaDCAaDrndBBZzX4jc/md1WAnCaZMWe1cYo0ws4SO2h/NZ4pJJIjJa6fVgVEht7KL/dwmMfHhv53HRSv7Y3lN7eR2kYj+X/q8bjYNrl/4TX9p3i1+MioveOyI72G0q53TxKDq0V3UhOQdUtsDZD217EwMe3jcdK7/Wqji7gILVV9wdmYmMLKfVT/P4P47xHFhF/Baw+e/JefHDIQT2/PNzdgwmkMWFee7cR3y7W97rppDXElxQctDo0ebyuiIiIeoFbUHULrDLXhFhtopXY2Xtt+APEwqG6mirLW1gdL2Jp9mvc3c3pTwZySD9YQXwbiH3zLZRSHwbW0jASy0nk3+4hpU4hFu72AbXYrQiiADQt37pteriuqI0COdyNe/iFxmv7TvHrcRHRe8ceVJ16Vt1Ywqq9XsCtFEB8pTqMLuDHuRAy6jLWjip/N0i//BVaeAp/nenCsbWZsvI9VufGEAGgHa5hqcc/KJWPQgCKOH5tPDH8ASLdPCAiIqIeIedHt6DqVrfqWAYgvtaqXW0rUWuVWoBSKkGZTiJv1l5tIb+suPZGWtvuoZzawkEr2otaubd7V5PExhMV9WDyMHfiuylECi/wtx2X83ydwX4BiH40UrGf/PIwMKrUXefq9bwBGNvfshz/6rh7c32Y2raPaedh/XRyB5lCFkuzk4jeS+NNlc32svxvx81toIHrSvD0nlep9VSWt6rWMjrux+V9N40qeLxxdW3lUwtItHoEwcs+PFy7ndTQ/9t2afQaEaMolvrYLp4HEflOrVrVahOsXJeusv/dKbR2ylebTzA/Lg+NhhCZS+BH5BF9kLO0TWxsYXXcNowaDiE2l0Ds8wjit/+OtFQf67W9JyUFX44D2nZG38aogoOHCWM4vAgNRayPLOO4AMxHogCs54LIn5F/NmbtvQuPYfXht3jTgvNQppNIVazMUIXTSg7hEGLqOsqTaxi4l7b+WyCNiXgaVapN/K9i5YAQVo/3sSo1ian7KKsADh2+B23U1mtXKA3j8d465u0lHOEQYur3eJz7GncdRgw0fFZx7UbCU1jdQ8W12yhP+/B67XZIR97DDkhsrjv8kmucRwRd+/4SkX9Um1AluJUC1FWz6jbhqiPCU5gfD0E7XEN8ZFKvu1KzAIDI5zHrb+3TSeMHfxGb6tUErrj6ApqxLctwu9f2uytXk8KMY8DhmjRRTH+YAXrmM8RQxP7LYz30PEtIdZshRAp/VO1tjIyPISIf2+wLZAAg/Cm+utXEeQB6eYI6BqCIjPSagZFFbB46HExJwYE6BiCLzVmp/ewaMgUA4zNcPaBRXq8roLH3vAHKyvdGULXuZ2B2EUuH7mUd4trN1Lp2m1D3Pvx67XboPeyMIjLba4jPTlq/vwB/NhARAFSdUOWpZtWJW/1qtY22WkZdRPRe2uxhSO88xWYBQPgDfCK1S0yOGe2liUwA0ruPEDVCgDyZyWt7r5SPQkDhVzx/DSgrM4jBWAVhZFE//oJ21WsSjjjsp4hNeVLW0SP8dAgAIXwojV42ch7KF5/qtaTbP2BCeg0COTgNauvHX8Tm7DLuHkntj9KYuP8CGkKY/GLE4ZVtVpLKJFJbeNzqYV2xcoB4z6QQuXQI6GsEGx/QnexVbfO1CwAoKfjrnBGmZq37wVEOa/dWHHtVdfprJmpcu82pbx9+vXY78h52yNq9O5h4kEZavh6O0sb7QUQEx6Aqnq+lrvElrwm4tbL4accWn8wZrtKSV8aQu97eYTM7vxi9LkbA9dq+AZ9EQnogxQi++jwEIIv15DGAKD4M22aRy8FVONypCANvNFtvVoPn8UlEDyH7L+urt9TbhzD/bL+ilrL8bAoRAJFItK5ttUxpGI/3pN7qcAjz6rq1ps6owWt+eTDbe1YaxkgYQI3e8bbowLULwFztwOk6rKmea7dZde7Dn9duh97DTnGsWa1R/05E75VmsqTlpgBed+pLruEhj98LLWhfLxFmAIigg8Nf9HBthID8b8e2dk3wch7mPqWZ7dW06hhb7VYMk2EARolIXM1CAxBTn+gTZ0rDRu9VEb/namzLhZhUUjbqViNz68bfjTrO8BRSx/vduYlCu65dwVjtoKVLc3WaX69dod3vYScYdc2rc2OI+Pl7TURd1UzOHLT/g5eHLxk9EZUDskZgtH84eG3vkablgVsxWPptjBCQl/ajvWoyEDR0HiGM3AJwVGPbgRyOCwDCxnCw1162djG+j5n9n/Ve6d0VRKFPpImp6/qkJ8AsxejleV6O2nztChGnyX+9wq/XrtCh97CtZv5s1DVnsTRrXaIvscHeVSLSNZMxffaTuxmiJ2IMXzpNSpj5TJ/RbQ63e23fIqVhPP7mqrdP1LI2vvxRA+chPsCd6gdHF7Do8OGiD692qS7VjTExaWI3YHlO9LACAApZLDUxozr94I5l4lNGnTQn82iAVMN6p4NBqMXX7qioTbXJ/aGf4/hnrV9yqoN8ee126+dPo9yuEYj1hwFt+6njWtJERM3qn58sgRyev9Lr1WLqE8tEG2V6AXlj2ZrM/s+NtbczP8hnqk7qiUSiwGtN70UdT1wNHxs1dKm5EFBtHdZaGjyPtf2rCRxi3VZlOom8UcNnl375KzQAkbnvfb92Ynp3BVExIzne3lv5tnyIvJ7rqtFrV962+Z4vIP9MXppLcvQI64cAMIbVvQdIjErHMzqMxEayJ2Z5+/Labfbnz7R+Z7iWl594vUYkltVZjPWh2atKRK3QP2EVQDr5gz5jG/pEG1Hkn1KnjJnvi5ZeOK/tLYzF/O2vNRdvN3svoc8oN3v79KV2zGV/Clks3W9uLcWGzsOcwDGFVWPiSUodQ6SQxabTnaaOHuEv23oPVWwuYdRpWhcAr/jQHF0wPlCN4zF6Zsy6T5fFx/1I3L3KrH0VpRzN3hDArtZ1ZWjoPZe3bb7nU/ryT4dZx8NZmzeWHwqPYfWZdDzP1ivXB/WrFl67MXXf8f3w3B5N/PwxRmf0XypDmP/u39zP3etxNXCNiF8Gruq391A2lunTeqXuloh8ra/CKgI53L29iKVtaRgYAApZbKqLFTcQ8Nze6bWHRetrJW+04tWSVGZv3x1M7Oawdu/OVc9fs0NnjZxHII2J2TVsFq6CqXa4hvjtZTx32U36wR3E1RfIFHr7tqmN0GeUXxFDny1Xx3VlaefpPddfsymvj1rIYmn2a0zsu+0njYkRh+MpFJFRf/BfDagLX167jf78CeTw/B9Xv/xuuvW+NnFMnq6Ro0eIzr7Q16w1aIUslmYX8ZdXPvp+E1HPGigbVazybVQvLi7Mx+npKU5PT3FycoKTkxO8e/cO7969wz//+U/8x3/+3fsejTvJaNs1wmA/mE6irIb8ObGDTMryFlJzIWTUSfeedCIiImrYf//Xt/jTn/6Emzdv4ubNmxgaGsLQ0BBu3LiBGzduYHBw0HwEg0EEg0EEjFFnfjK3085TbBZqDNMRERERkauuhVVL3eLbZE/PNnYVyOHu/RfQxhPIb1gndiijCg5SC/153n5XUnDgUMdHRERE/jNYuwk15egRorMaDh7OIHWcMJ/WClnsv3rq/zUUiYiIiLqo82F1dwUDuw7P+2EtwXY5SmMi7nLf+H4+b78KpDHxsdP7wfeCiIjIb/jpTERERES+xbBKRERERL7FsEpEREREvsWwSkRERES+xbBKRERERL7FsEpEREREvsWwSkRERES+xbBKRERERL7FsEpEREREvsWwSkRERES+xbBKRERERL7FsEpEREREvjXY8T1OJ1FWx2xPZrE0soy1ALMzdUBJwcFxAjHb0xl1EhO7vAaJiIj8hJ/MHaRML+AgtYfyW+ORSiIxWur2YVVIbOyh/HYLj314bERERPR+6VpY1bYXMfDxbeOx0nu9qqMLOEhtobyh1NU8sbGFlPopfv+Hcd4ji4i/AlafPcHBdP+HQjmo55eHu3swgTQmzGvvNuLbxfpeN520hviSgoO3e3VfA0RERORdjyVEHxn+ALFwqK6myvIWVseLWJr9Gnd3c/qTgRzSD1YQ3wZi33wLpdSHgbU0jMRyEvm3e0ipU4iFu31ALXYrgigATct3+0iIiIj6FsNqu40u4Me5EDLqMtaOKr/d6Ze/QgtP4a8zXTi2NlNWvsfq3BgiALTDNSzV24PpU8pHIQBFHL82nhj+AJFuHhAREdF7wL9htTSMx6k9lFMLUEolKNNJ5M16zy3klxXX3khr2z2UU1s4aEX76eRVGzFJbDxx9dzbymHuxHdTiBRe4G87Luf5OoP9AhD9aKRiP/nlYWBUqbvO1et5AzC2v2U5/tVx9+Z6+YNtH9POw/rp5A4yhSyWZicRvZfGmyqb7WX53467fQhERER9q/OrATTgq80nmB+Xh9xDiMwl8CPyiD7IWdomNrawOm4bng+HEJtLIPZ5BPHbf0daqo/12t6TkoIvxwFtO6NvY1TBwcOEMRxehIYi1keWcVwA5iNRANZzQeTPyD8bs/behcew+vBbvGnBeSjTSaQqVmaowmklh3AIMXUd5ck1DNxLW/8tkMZEPA0//05UU8XKASGsHu9jVWoSU/dRVgEcOnwPiIiIqCn+TxHhKcyPh6AdriE+MqlPiFGzAIDI5zFrr+F00ghsRWyqVxO44uoLaMa2LMPtXtvvrlxNCjOOAYdr0kQx/WEG6JnPEEMR+y+P9dDzLCHVbYYQKfxRtbcxMj6GiHxssy+QAYDwp/jqVhPnAejlCeoYgCIy0msGRhaxeehwMCUFB+oYgCw2Z6X2s2vIFACMz3D1ACIiImo5/4dVABl1EdF7abNnML3zFJsFAOEP8InULjE5ZrSXJjIBSO8+QtQIl/JkJq/tvVI+CgGFX/H8NaCszCAGYxWEkUX9+AvaVW9nOOKwnyI25UlZR4/w0yEAhPChNPLeyHkoX3yq15Ju/4AJ6TUI5OA0qK0ffxGbs8u4eyS1P0pj4v4LaAhh8osRh1e2WUkqk0ht4bFLSULDxMoB4j2TfjlZOgT0NYL1X6LYq0pERNR6PRBWs/hpxxafAjncjduWvDKG3PX2DpvZ+cXolTQCrtf2DfgkEtIDKUbw1echAFmsJ48BRPFh2DaLXA6uwuEO7tomZb3RbJOUGjyPTyJ6T+z+y/rqLfX2Icw/26+o0S0/m0IEQCQSrWtbLVMaxuM9qbc6HMK8um5dCsyo/21+eTDbe1YaxkgYQI3ecSIiImpOD4RVj1zDQx6/F1rQvl4izAAQQQeHv+jh2ljyKP/bsa1dE7ych7lPaWZ7Na06xla7FcNkGIBRIhJXs9AAxNQn+qSv0rDR61zE77ka23KhLBuTz4y61cjcuvH3dcyHAYSnkDre500UiIiI2qQnJlh5YvQgVg7IGoHRHuq8tvdI0/LArRgsfY7Gkkd5aT/aqybX6mzoPEIYuQXgqMa2AzkcFwCEjbIEhyW4usL4Pmb2f9Z7pXdXEIU+CSymruuTngCzFKMPfzUjIiLqe3308S16EMfwpdOapTOf6TO6zeF2r+1bpDSMx99c9faJWtbGlz9q4DxE+LTVvgIARhew6LB0lV5+0KW6VDfGhLeJ3YDlOdHDCgAoZLHUxIoO6Qd3LBPqMuqkOdlNA6Qa1jv+CfFERER9pH8+XQM5PH+l13PG1CeWiTbK9ALyxpJLmf2fG2tvl/tDDyvjM1Un9UQiUeC1pveijieuho+N+s/UXAiotg5rLQ2ex9r+1cQrsW6rMp1E3qg/tUu//BUagMjc97XXbu2y9O4KomK1gnh7b+XLu1cRERG1l+VTfGBgwNPDb9LJH/QZ29An2ogJQCl1ypj5vmjphfPa3sJYzN/+WnMxf7P3EvqMcrO3T18qaunQmChVyGLpfhNruTZ6HubEqymsGpOmUuoYIoUsNp3uNHX0CH/Z1ntXY3MJo05TnmjlULM5uoC81CY1p68Da9Z9vt1DeUNp+Lw7Sdy9yqx9FaUcvCEAERFRTc1kzIC8Ea879Z1ADndvL2JpWxoGBoBCFpvqYsUNBDy3d3rtYdH6WskbrXi1JJXZ23cHE7s5rN27c9Xz1+zwcSPnEUhjYnYNm4WrYKodriF+exnPXXaTfnAHcfUFMoXevm1qI/TVEK7o4ZWIiIjq0UzOHCiXy2UAKJfLuLy8xOXlJS4uLszH6ekpzs7OcHJygpOTE7x79858/Pv9de9Ha9wFSduuEQb7wXQSZTXkr0lJVEFZ3kJqLoSMOunek05EREQN+5+Hi7h586b5GBoawtDQEK5fv44bN25gcHDQfASDQQSDQTOw1vxkFg3lrtlAIODPnlW/2XmKzUII89/9W7ePhIiIiKhr5PwoD/XXkyddw6pbDYHYUaDJSSuWusW3SSR8PGGnYYEc7t5/AW08gfyGdVKSMqrgILXQn+ftdyUFBw61tERERNQecn70OhfKcZ1V+wucAmuzYfW9cfQI0VkNBw9nkDpOmE9rhSz2Xz3l3Y+IiIio74nsWC2gugXWirDqNOxvD6milqAhuysY2HU8i8a21wuO0piIu9w3vp/P268CaUx87PR+8L0gIiJqB5Ed3UJrtbKAiqWr7F+dgqr4SkRERERUi5wfnQIrUJlDhbpqVsVGW9KzSkRERETvFXvPqltgdVIRVqtNqJKD6uCgY7krEREREZGFvCSVHFRr1bEC0jqrAFAqlXB5eWl+vby8xPn5ufk4OzvD6ekpTk9PzXVXT05OzOfOzs5wdnaG8/Nzy1qtYnvlctl8EBEREVFvkUOlCJ7yGqnXrl3D9evXzfVTb9y4Ya6pOjQ0ZD53/fp1XLt2zXzIQVZ8FWpOsHIqARAHI4KtCJ+ifTAYxMXFhXmDgVKpZD4YVomIiIh6k1M+FL2mIh/KgVUOpaKdWymA2L6d69JV9lIAefhf9JReu3bNMagODg6aYVUEWoZVIiIiot7mFFbljOgUWEVQtd+hqp4SAMAWVt2WqpKTc7lctgRP8Tq3oCqHVZYBEBEREfWuakuaOgVWEVrtgbXaRCt7aHUsA3DqVZWDphw2a/WoyqUCDKtEREREvcstJzr1sNp7WeVSAC+9qzXLAAKBAMrlckVgFeQa1XqDKsMqERERUe9xu2lUtcAqQqtTUK1n+aqKMgAAKJfLroHVfrD2iVdyUBUlA+Kr2DbDKhEREVHvkUOlffkpe2C1h1bx91o3BqhZBiAaioMQ7AFT3mggELD0pDpNqJJDKsMqERERUe9xusup2+pR9p5Wp15VpxUB7KqGVflg5ODq1PVrH/avNvzPsEpERETUe9zCqv1GUnIgdQupTttw4jjBSp7lLwdVtwMTvaiirrVWjyrDKhEREVHvsa+HWuvOp/aeVre7V9m3L6vasypqVwGYdav2A7MP9zstUWWvU2VYJSIiIuo9TqPv8p/tIdRpuL/eWlXBMazaD0YmQqt98lWtkMqASkRERNQ/nIJmtdDqNEJfqwQAqBJW5YOQ/+4WSOXyAbeQysBKRERE1Puchu7dQmut3tRqQRWoEVbtB2PndrMAt95UhlUiIiKi3ufUoWn/Wiuc1hNUgTrCqtsBVetFZUglIiIi6n/1hla3f6trH+UGkmStIX6nTTKwEhEREfUPp7DpNrPfa0C1bLORsGrntgkGVCIiIqL+5xZCGwmnFdtoRVglIiIiImqHQO0mRERERETd8f8eioGNxEGb2gAAAABJRU5ErkJggg=="},653:function(t,s){t.exports="data:image/png;base64,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"},654:function(t,s,a){t.exports=a.p+"assets/img/image-20210821091835406.2a25f22f.png"},655:function(t,s){t.exports="data:image/png;base64,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"},656:function(t,s,a){t.exports=a.p+"assets/img/image-20210821092657918.7c20f84f.png"},657:function(t,s,a){t.exports=a.p+"assets/img/image-20210821092902946.ab0fade5.png"},658:function(t,s){t.exports="data:image/png;base64,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"},659:function(t,s,a){t.exports=a.p+"assets/img/yeVDlwtfMx.52360b72.png"},660:function(t,s,a){t.exports=a.p+"assets/img/image-20210821093144700.fec13088.png"},661:function(t,s,a){t.exports=a.p+"assets/img/image-20210821094447709.972c5697.png"},662:function(t,s,a){t.exports=a.p+"assets/img/image-20210821100755080.7b034e41.png"},663:function(t,s,a){t.exports=a.p+"assets/img/image-20210821100801756.edc1a113.png"},664:function(t,s,a){t.exports=a.p+"assets/img/image-20210821101217089.a234b8a2.png"},665:function(t,s,a){t.exports=a.p+"assets/img/image-20210821101433528.a463639e.png"},666:function(t,s,a){t.exports=a.p+"assets/img/image-20210821101721649.e646cf8a.png"},667:function(t,s,a){t.exports=a.p+"assets/img/image-20210821102235467.24158863.png"},668:function(t,s,a){t.exports=a.p+"assets/img/image-20210821102610167.91cdecae.png"},669:function(t,s,a){t.exports=a.p+"assets/img/image-20210821102959829.32a800ae.png"},670:function(t,s,a){t.exports=a.p+"assets/img/image-20210821104149061.c9985fd8.png"},671:function(t,s,a){t.exports=a.p+"assets/img/image-20210821104857413.ace78437.png"},672:function(t,s,a){t.exports=a.p+"assets/img/image-20210821110441222.a45f6896.png"},673:function(t,s,a){t.exports=a.p+"assets/img/image-20210821111023255.6cf7c771.png"},674:function(t,s,a){t.exports=a.p+"assets/img/image-20210821112420464.25a1f0a5.png"},675:function(t,s,a){t.exports=a.p+"assets/img/image-20210821112444482.d69b685d.png"},676:function(t,s,a){t.exports=a.p+"assets/img/image-20210821112559965.07797dc2.png"},677:function(t,s,a){t.exports=a.p+"assets/img/image-20210821112637430.97183375.png"},678:function(t,s,a){t.exports=a.p+"assets/img/image-20210821113340111.abf4482e.png"},679:function(t,s,a){t.exports=a.p+"assets/img/image-20210821114528954.b9038b72.png"},680:function(t,s,a){t.exports=a.p+"assets/img/image-20210821114742950.c27e5895.png"},681:function(t,s,a){t.exports=a.p+"assets/img/image-20210821115108528.0fed4f9c.png"},682:function(t,s,a){t.exports=a.p+"assets/img/image-20210821115552327.86f59ecb.png"},683:function(t,s,a){t.exports=a.p+"assets/img/image-20210821115719363.0bc4b2ea.png"},684:function(t,s,a){t.exports=a.p+"assets/img/image-20210821115914748.a8498931.png"},685:function(t,s,a){t.exports=a.p+"assets/img/image-20210821115948395.afcdbb60.png"},686:function(t,s){t.exports="data:image/png;base64,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"},687:function(t,s,a){t.exports=a.p+"assets/img/image-20210821120049024.8ecf7133.png"},870:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"多级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#多级缓存"}},[t._v("#")]),t._v(" 多级缓存")]),t._v(" "),s("h1",{attrs:{id:"_0-学习目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-学习目标"}},[t._v("#")]),t._v(" 0.学习目标")]),t._v(" "),s("h1",{attrs:{id:"_1-什么是多级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是多级缓存"}},[t._v("#")]),t._v(" 1.什么是多级缓存")]),t._v(" "),s("p",[t._v("传统的缓存策略一般是请求到达Tomcat后，先查询Redis，如果未命中则查询数据库，如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(645),alt:"image-20210821075259137"}})]),t._v(" "),s("p",[t._v("存在下面的问题：")]),t._v(" "),s("p",[t._v("•请求要经过Tomcat处理，Tomcat的性能成为整个系统的瓶颈")]),t._v(" "),s("p",[t._v("•Redis缓存失效时，会对数据库产生冲击")]),t._v(" "),s("p",[t._v("多级缓存就是充分利用请求处理的每个环节，分别添加缓存，减轻Tomcat压力，提升服务性能：")]),t._v(" "),s("ul",[s("li",[t._v("浏览器访问静态资源时，优先读取浏览器本地缓存")]),t._v(" "),s("li",[t._v("访问非静态资源（ajax查询数据）时，访问服务端")]),t._v(" "),s("li",[t._v("请求到达Nginx后，优先读取Nginx本地缓存")]),t._v(" "),s("li",[t._v("如果Nginx本地缓存未命中，则去直接查询Redis（不经过Tomcat）")]),t._v(" "),s("li",[t._v("如果Redis查询未命中，则查询Tomcat")]),t._v(" "),s("li",[t._v("请求进入Tomcat后，优先查询JVM进程缓存")]),t._v(" "),s("li",[t._v("如果JVM进程缓存未命中，则查询数据库")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(646),alt:"image-20210821075558137"}})]),t._v(" "),s("p",[t._v("在多级缓存架构中，Nginx内部需要编写本地缓存查询、Redis查询、Tomcat查询的业务逻辑，因此这样的nginx服务不再是一个"),s("strong",[t._v("反向代理服务器")]),t._v("，而是一个编写"),s("strong",[t._v("业务的Web服务器了")]),t._v("。")]),t._v(" "),s("p",[t._v("因此这样的业务Nginx服务也需要搭建集群来提高并发，再有专门的nginx服务来做反向代理，如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(647),alt:"image-20210821080511581"}})]),t._v(" "),s("p",[t._v("另外，我们的Tomcat服务将来也会部署为集群模式：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(648),alt:"image-20210821080954947"}})]),t._v(" "),s("p",[t._v("可见，多级缓存的关键有两个：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("一个是在nginx中编写业务，实现nginx本地缓存、Redis、Tomcat的查询")])]),t._v(" "),s("li",[s("p",[t._v("另一个就是在Tomcat中实现JVM进程缓存")])])]),t._v(" "),s("p",[t._v("其中Nginx编程则会用到OpenResty框架结合Lua这样的语言。")]),t._v(" "),s("p",[t._v("这也是今天课程的难点和重点。")]),t._v(" "),s("h1",{attrs:{id:"_2-jvm进程缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-jvm进程缓存"}},[t._v("#")]),t._v(" 2.JVM进程缓存")]),t._v(" "),s("p",[t._v("为了演示多级缓存的案例，我们先准备一个商品查询的业务。")]),t._v(" "),s("h2",{attrs:{id:"_2-1-导入案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-导入案例"}},[t._v("#")]),t._v(" 2.1.导入案例")]),t._v(" "),s("p",[t._v("参考课前资料的：《案例导入说明.md》")]),t._v(" "),s("p",[s("img",{attrs:{src:a(649),alt:"image-20210821081418456"}})]),t._v(" "),s("h2",{attrs:{id:"_2-2-初识caffeine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-初识caffeine"}},[t._v("#")]),t._v(" 2.2.初识Caffeine")]),t._v(" "),s("p",[t._v("缓存在日常开发中启动至关重要的作用，由于是存储在内存中，数据的读取速度是非常快的，能大量减少对数据库的访问，减少数据库的压力。我们把缓存分为两类：")]),t._v(" "),s("ul",[s("li",[t._v("分布式缓存，例如Redis：\n"),s("ul",[s("li",[t._v("优点：存储容量更大、可靠性更好、可以在集群间共享")]),t._v(" "),s("li",[t._v("缺点：访问缓存有网络开销")]),t._v(" "),s("li",[t._v("场景：缓存数据量较大、可靠性要求较高、需要在集群间共享")])])]),t._v(" "),s("li",[t._v("进程本地缓存，例如HashMap、GuavaCache：\n"),s("ul",[s("li",[t._v("优点：读取本地内存，没有网络开销，速度更快")]),t._v(" "),s("li",[t._v("缺点：存储容量有限、可靠性较低、无法共享")]),t._v(" "),s("li",[t._v("场景：性能要求较高，缓存数据量较小")])])])]),t._v(" "),s("p",[t._v("我们今天会利用Caffeine框架来实现JVM进程缓存。")]),t._v(" "),s("p",[s("strong",[t._v("Caffeine")]),t._v("是一个基于Java8开发的，提供了近乎最佳命中率的高性能的本地缓存库。目前Spring内部的缓存使用的就是Caffeine。GitHub地址：https://github.com/ben-manes/caffeine")]),t._v(" "),s("p",[t._v("Caffeine的性能非常好，下图是官方给出的性能对比：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(650),alt:"image-20210821081826399"}})]),t._v(" "),s("p",[t._v("可以看到Caffeine的性能遥遥领先！")]),t._v(" "),s("p",[t._v("缓存使用的基本API：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Test")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testBasicOps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构建cache对象")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Caffeine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 存数据")]),t._v("\n    cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"迪丽热巴"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 取数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" gf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getIfPresent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gf"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gf = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" gf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 取数据，包含两个参数：")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参数一：缓存的key")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参数二：Lambda表达式，表达式参数就是缓存的key，方法体是查询数据库的逻辑")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 优先根据key查询JVM缓存，如果未命中，则执行参数二的Lambda表达式")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" defaultGF "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"defaultGF"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据key去数据库查询数据")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"柳岩"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"defaultGF = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" defaultGF"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Caffeine既然是缓存的一种，肯定需要有缓存的清除策略，不然的话内存总会有耗尽的时候。")]),t._v(" "),s("p",[t._v("Caffeine提供了三种缓存驱逐策略：")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("基于容量")]),t._v("：设置缓存的数量上限")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建缓存对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Caffeine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("maximumSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置缓存大小上限为 1")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("基于时间")]),t._v("：设置缓存的有效时间")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建缓存对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Caffeine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置缓存有效期为 10 秒，从最后一次写入开始计时 ")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("expireAfterWrite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofSeconds")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("基于引用")]),t._v("：设置缓存为软引用或弱引用，利用GC来回收缓存数据。性能较差，不建议使用。")])])]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("注意")]),t._v("：在默认情况下，当一个缓存元素过期的时候，Caffeine不会自动立即将其清理和驱逐。而是在一次读或写操作后，或者在空闲时间完成对失效数据的驱逐。")])]),t._v(" "),s("h2",{attrs:{id:"_2-3-实现jvm进程缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-实现jvm进程缓存"}},[t._v("#")]),t._v(" 2.3.实现JVM进程缓存")]),t._v(" "),s("h3",{attrs:{id:"_2-3-1-需求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-需求"}},[t._v("#")]),t._v(" 2.3.1.需求")]),t._v(" "),s("p",[t._v("利用Caffeine实现下列需求：")]),t._v(" "),s("ul",[s("li",[t._v("给根据id查询商品的业务添加缓存，缓存未命中时查询数据库")]),t._v(" "),s("li",[t._v("给根据id查询商品库存的业务添加缓存，缓存未命中时查询数据库")]),t._v(" "),s("li",[t._v("缓存初始大小为100")]),t._v(" "),s("li",[t._v("缓存上限为10000")])]),t._v(" "),s("h3",{attrs:{id:"_2-3-2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-实现"}},[t._v("#")]),t._v(" 2.3.2.实现")]),t._v(" "),s("p",[t._v("首先，我们需要定义两个Caffeine的缓存对象，分别保存商品、库存的缓存数据。")]),t._v(" "),s("p",[t._v("在item-service的"),s("code",[t._v("com.heima.item.config")]),t._v("包下定义"),s("code",[t._v("CaffeineConfig")]),t._v("类：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("benmanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("caffeine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("benmanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("caffeine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Caffeine")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Bean")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Configuration")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CaffeineConfig")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("itemCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Caffeine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialCapacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("maximumSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10_000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stockCache")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Caffeine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialCapacity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("maximumSize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10_000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后，修改item-service中的"),s("code",[t._v("com.heima.item.web")]),t._v("包下的ItemController类，添加缓存逻辑：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RestController")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemService")]),t._v(" itemService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemStockService")]),t._v(" stockService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" itemCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" stockCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...其它略")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/{id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" itemCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" itemService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("query")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ne")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("eq")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("one")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/stock/{id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findStockById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" stockCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" stockService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h1",{attrs:{id:"_3-lua语法入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-lua语法入门"}},[t._v("#")]),t._v(" 3.Lua语法入门")]),t._v(" "),s("p",[t._v("Nginx编程需要用到Lua语言，因此我们必须先入门Lua的基本语法。")]),t._v(" "),s("h2",{attrs:{id:"_3-1-初识lua"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-初识lua"}},[t._v("#")]),t._v(" 3.1.初识Lua")]),t._v(" "),s("p",[t._v("Lua 是一种轻量小巧的脚本语言，用标准C语言编写并以源代码形式开放， 其设计目的是为了嵌入应用程序中，从而为应用程序提供灵活的扩展和定制功能。官网：https://www.lua.org/")]),t._v(" "),s("p",[s("img",{attrs:{src:a(651),alt:"image-20210821091437975"}})]),t._v(" "),s("p",[t._v("Lua经常嵌入到C语言开发的程序中，例如游戏开发、游戏插件等。")]),t._v(" "),s("p",[t._v("Nginx本身也是C语言开发，因此也允许基于Lua做拓展。")]),t._v(" "),s("h2",{attrs:{id:"_3-1-helloworld"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-helloworld"}},[t._v("#")]),t._v(" 3.1.HelloWorld")]),t._v(" "),s("p",[t._v("CentOS7默认已经安装了Lua语言环境，所以可以直接运行Lua代码。")]),t._v(" "),s("p",[t._v("1）在Linux虚拟机的任意目录下，新建一个hello.lua文件")]),t._v(" "),s("p",[s("img",{attrs:{src:a(652),alt:"image-20210821091621308"}})]),t._v(" "),s("p",[t._v("2）添加下面的内容")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])]),s("p",[t._v("3）运行")]),t._v(" "),s("p",[s("img",{attrs:{src:a(653),alt:"image-20210821091638140"}})]),t._v(" "),s("h2",{attrs:{id:"_3-2-变量和循环"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-变量和循环"}},[t._v("#")]),t._v(" 3.2.变量和循环")]),t._v(" "),s("p",[t._v("学习任何语言必然离不开变量，而变量的声明必须先知道数据的类型。")]),t._v(" "),s("h3",{attrs:{id:"_3-2-1-lua的数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-lua的数据类型"}},[t._v("#")]),t._v(" 3.2.1.Lua的数据类型")]),t._v(" "),s("p",[t._v("Lua中支持的常见数据类型包括：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(654),alt:"image-20210821091835406"}})]),t._v(" "),s("p",[t._v("另外，Lua提供了type()函数来判断一个变量的数据类型：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(655),alt:"image-20210821091904332"}})]),t._v(" "),s("h3",{attrs:{id:"_3-2-2-声明变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-声明变量"}},[t._v("#")]),t._v(" 3.2.2.声明变量")]),t._v(" "),s("p",[t._v("Lua声明变量的时候无需指定数据类型，而是用local来声明变量为局部变量：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明字符串，可以用单引号或双引号，")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 字符串拼接可以使用 ..")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" str2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明数字")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" num "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明布尔类型")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" flag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("true")]),t._v("\n")])])]),s("p",[t._v("Lua中的table类型既可以作为数组，又可以作为Java中的map来使用。数组就是特殊的table，key是数组角标而已：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明数组 ，key为角标的 table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lua'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明table，类似java的map")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" map "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jack'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Lua中的数组角标是从1开始，访问的时候与Java中类似：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 访问数组，lua数组的角标从1开始")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Lua中的table可以用key来访问：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 访问table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-2-3-循环"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-循环"}},[t._v("#")]),t._v(" 3.2.3.循环")]),t._v(" "),s("p",[t._v("对于table，我们可以利用for循环来遍历。不过数组和普通table遍历略有差异。")]),t._v(" "),s("p",[t._v("遍历数组：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明数组 key为索引的 table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lua'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 遍历数组")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ipairs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("遍历普通table")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 声明map，也就是table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" map "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Jack'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 遍历table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("pairs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("h2",{attrs:{id:"_3-3-条件控制、函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-条件控制、函数"}},[t._v("#")]),t._v(" 3.3.条件控制、函数")]),t._v(" "),s("p",[t._v("Lua中的条件控制和函数声明与Java类似。")]),t._v(" "),s("h3",{attrs:{id:"_3-3-1-函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-函数"}},[t._v("#")]),t._v(" 3.3.1.函数")]),t._v(" "),s("p",[t._v("定义函数的语法：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" 函数名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" argument1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argument2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" argumentn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 函数体")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" 返回值\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("例如，定义一个函数，用来打印数组：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printArr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ipairs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("h3",{attrs:{id:"_3-3-2-条件控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-条件控制"}},[t._v("#")]),t._v(" 3.3.2.条件控制")]),t._v(" "),s("p",[t._v("类似Java的条件控制，例如if、else语法：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("布尔表达式"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--[ 布尔表达式为 true 时执行该语句块 --]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--[ 布尔表达式为 false 时执行该语句块 --]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n")])])]),s("p",[t._v("与java不同，布尔表达式中的逻辑运算是基于英文单词：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(656),alt:"image-20210821092657918"}})]),t._v(" "),s("h3",{attrs:{id:"_3-3-3-案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-案例"}},[t._v("#")]),t._v(" 3.3.3.案例")]),t._v(" "),s("p",[t._v("需求：自定义一个函数，可以打印table，当参数为nil时，打印错误信息")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printArr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'数组不能为空！'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ipairs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("h1",{attrs:{id:"_4-实现多级缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-实现多级缓存"}},[t._v("#")]),t._v(" 4.实现多级缓存")]),t._v(" "),s("p",[t._v("多级缓存的实现离不开Nginx编程，而Nginx编程又离不开OpenResty。")]),t._v(" "),s("h2",{attrs:{id:"_4-1-安装openresty"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装openresty"}},[t._v("#")]),t._v(" 4.1.安装OpenResty")]),t._v(" "),s("p",[t._v("OpenResty® 是一个基于 Nginx的高性能 Web 平台，用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。具备下列特点：")]),t._v(" "),s("ul",[s("li",[t._v("具备Nginx的完整功能")]),t._v(" "),s("li",[t._v("基于Lua语言进行扩展，集成了大量精良的 Lua 库、第三方模块")]),t._v(" "),s("li",[t._v("允许使用Lua"),s("strong",[t._v("自定义业务逻辑")]),t._v("、"),s("strong",[t._v("自定义库")])])]),t._v(" "),s("p",[t._v("官方网站： https://openresty.org/cn/")]),t._v(" "),s("p",[s("img",{attrs:{src:a(657),alt:"image-20210821092902946"}})]),t._v(" "),s("p",[t._v("安装Lua可以参考课前资料提供的《安装OpenResty.md》：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(658),alt:"image-20210821092941139"}})]),t._v(" "),s("h2",{attrs:{id:"_4-2-openresty快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-openresty快速入门"}},[t._v("#")]),t._v(" 4.2.OpenResty快速入门")]),t._v(" "),s("p",[t._v("我们希望达到的多级缓存架构如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(659),alt:"yeVDlwtfMx"}})]),t._v(" "),s("p",[t._v("其中：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("windows上的nginx用来做反向代理服务，将前端的查询商品的ajax请求代理到OpenResty集群")])]),t._v(" "),s("li",[s("p",[t._v("OpenResty集群用来编写多级缓存业务")])])]),t._v(" "),s("h3",{attrs:{id:"_4-2-1-反向代理流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-1-反向代理流程"}},[t._v("#")]),t._v(" 4.2.1.反向代理流程")]),t._v(" "),s("p",[t._v("现在，商品详情页使用的是假的商品数据。不过在浏览器中，可以看到页面有发起ajax请求查询真实商品数据。")]),t._v(" "),s("p",[t._v("这个请求如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(660),alt:"image-20210821093144700"}})]),t._v(" "),s("p",[t._v("请求地址是localhost，端口是80，就被windows上安装的Nginx服务给接收到了。然后代理给了OpenResty集群：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(661),alt:"image-20210821094447709"}})]),t._v(" "),s("p",[t._v("我们需要在OpenResty中编写业务，查询商品数据并返回到浏览器。")]),t._v(" "),s("p",[t._v("但是这次，我们先在OpenResty接收请求，返回假的商品数据。")]),t._v(" "),s("h3",{attrs:{id:"_4-2-2-openresty监听请求"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-2-openresty监听请求"}},[t._v("#")]),t._v(" 4.2.2.OpenResty监听请求")]),t._v(" "),s("p",[t._v("OpenResty的很多功能都依赖于其目录下的Lua库，需要在nginx.conf中指定依赖库的目录，并导入依赖：")]),t._v(" "),s("p",[t._v("1）添加对OpenResty的Lua模块的加载")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/local/openresty/nginx/conf/nginx.conf")]),t._v("文件，在其中的http下面，添加下面代码：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#lua 模块")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lua_package_path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/openresty/lualib/?.lua;;"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#c模块     ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lua_package_cpath")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/openresty/lualib/?.so;;"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n")])])]),s("p",[t._v("2）监听/api/item路径")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/local/openresty/nginx/conf/nginx.conf")]),t._v("文件，在nginx.conf的server下面，添加对/api/item这个路径的监听：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v("  /api/item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认的响应类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" application/json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 响应结果由lua/item.lua文件来决定")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("content_by_lua_file")]),t._v(" lua/item.lua")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("这个监听，就类似于SpringMVC中的"),s("code",[t._v('@GetMapping("/api/item")')]),t._v("做路径映射。")]),t._v(" "),s("p",[t._v("而"),s("code",[t._v("content_by_lua_file lua/item.lua")]),t._v("则相当于调用item.lua这个文件，执行其中的业务，把结果返回给用户。相当于java中调用service。")]),t._v(" "),s("h3",{attrs:{id:"_4-2-3-编写item-lua"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-3-编写item-lua"}},[t._v("#")]),t._v(" 4.2.3.编写item.lua")]),t._v(" "),s("p",[t._v("1）在"),s("code",[t._v("/usr/loca/openresty/nginx")]),t._v("目录创建文件夹：lua")]),t._v(" "),s("p",[s("img",{attrs:{src:a(662),alt:"image-20210821100755080"}})]),t._v(" "),s("p",[t._v("2）在"),s("code",[t._v("/usr/loca/openresty/nginx/lua")]),t._v("文件夹下，新建文件：item.lua")]),t._v(" "),s("p",[s("img",{attrs:{src:a(663),alt:"image-20210821100801756"}})]),t._v(" "),s("p",[t._v("3）编写item.lua，返回假数据")]),t._v(" "),s("p",[t._v("item.lua中，利用ngx.say()函数返回数据到Response中")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"id":10001,"name":"SALSA AIR","title":"RIMOWA 21寸托运箱拉杆箱 SALSA AIR系列果绿色 820.70.36.4","price":17900,"image":"https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp","category":"拉杆箱","brand":"RIMOWA","spec":"","status":1,"createTime":"2019-04-30T16:00:00.000+00:00","updateTime":"2019-04-30T16:00:00.000+00:00","stock":2999,"sold":31290}\'')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("4）重新加载配置")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("p",[t._v("刷新商品页面：http://localhost/item.html?id=1001，即可看到效果：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(664),alt:"image-20210821101217089"}})]),t._v(" "),s("h2",{attrs:{id:"_4-3-请求参数处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-请求参数处理"}},[t._v("#")]),t._v(" 4.3.请求参数处理")]),t._v(" "),s("p",[t._v("上一节中，我们在OpenResty接收前端请求，但是返回的是假数据。")]),t._v(" "),s("p",[t._v("要返回真实数据，必须根据前端传递来的商品id，查询商品信息才可以。")]),t._v(" "),s("p",[t._v("那么如何获取前端传递的商品参数呢？")]),t._v(" "),s("h3",{attrs:{id:"_4-3-1-获取参数的api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-获取参数的api"}},[t._v("#")]),t._v(" 4.3.1.获取参数的API")]),t._v(" "),s("p",[t._v("OpenResty中提供了一些API用来获取不同类型的前端请求参数：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(665),alt:"image-20210821101433528"}})]),t._v(" "),s("h3",{attrs:{id:"_4-3-2-获取参数并返回"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-获取参数并返回"}},[t._v("#")]),t._v(" 4.3.2.获取参数并返回")]),t._v(" "),s("p",[t._v("在前端发起的ajax请求如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(666),alt:"image-20210821101721649"}})]),t._v(" "),s("p",[t._v("可以看到商品id是以路径占位符方式传递的，因此可以利用正则表达式匹配的方式来获取ID")]),t._v(" "),s("p",[t._v("1）获取商品id")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/loca/openresty/nginx/nginx.conf")]),t._v("文件中监听/api/item的代码，利用正则表达式获取ID：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" ~ /api/item/(\\d+)")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认的响应类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v(" application/json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 响应结果由lua/item.lua文件来决定")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("content_by_lua_file")]),t._v(" lua/item.lua")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("2）拼接ID并返回")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/loca/openresty/nginx/lua/item.lua")]),t._v("文件，获取id并拼接到结果中返回：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取商品id")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("var"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 拼接并返回")]),t._v("\nngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{\"id\":'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\',"name":"SALSA AIR","title":"RIMOWA 21寸托运箱拉杆箱 SALSA AIR系列果绿色 820.70.36.4","price":17900,"image":"https://m.360buyimg.com/mobilecms/s720x720_jfs/t6934/364/1195375010/84676/e9f2c55f/597ece38N0ddcbc77.jpg!q70.jpg.webp","category":"拉杆箱","brand":"RIMOWA","spec":"","status":1,"createTime":"2019-04-30T16:00:00.000+00:00","updateTime":"2019-04-30T16:00:00.000+00:00","stock":2999,"sold":31290}\'')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("3）重新加载并测试")]),t._v(" "),s("p",[t._v("运行命令以重新加载OpenResty配置：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("p",[t._v("刷新页面可以看到结果中已经带上了ID：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(667),alt:"image-20210821102235467"}})]),t._v(" "),s("h2",{attrs:{id:"_4-4-查询tomcat"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-查询tomcat"}},[t._v("#")]),t._v(" 4.4.查询Tomcat")]),t._v(" "),s("p",[t._v("拿到商品ID后，本应去缓存中查询商品信息，不过目前我们还未建立nginx、redis缓存。因此，这里我们先根据商品id去tomcat查询商品信息。我们实现如图部分：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(668),alt:"image-20210821102610167"}})]),t._v(" "),s("p",[t._v("需要注意的是，我们的OpenResty是在虚拟机，Tomcat是在Windows电脑上。两者IP一定不要搞错了。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(669),alt:"image-20210821102959829"}})]),t._v(" "),s("h3",{attrs:{id:"_4-4-1-发送http请求的api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-发送http请求的api"}},[t._v("#")]),t._v(" 4.4.1.发送http请求的API")]),t._v(" "),s("p",[t._v("nginx提供了内部API用以发送http请求：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("capture")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/path"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTTP_GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 请求方式")]),t._v("\n    args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- get方式传参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("返回的响应内容包括：")]),t._v(" "),s("ul",[s("li",[t._v("resp.status：响应状态码")]),t._v(" "),s("li",[t._v("resp.header：响应头，是一个table")]),t._v(" "),s("li",[t._v("resp.body：响应体，就是响应数据")])]),t._v(" "),s("p",[t._v("注意：这里的path是路径，并不包含IP和端口。这个请求会被nginx内部的server监听并处理。")]),t._v(" "),s("p",[t._v("但是我们希望这个请求发送到Tomcat服务器，所以还需要编写一个server来对这个路径做反向代理：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /path")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里是windows电脑的ip和Java服务端口，需要确保windows防火墙处于关闭状态")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://192.168.150.1:8081")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("原理如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(670),alt:"image-20210821104149061"}})]),t._v(" "),s("h3",{attrs:{id:"_4-4-2-封装http工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-封装http工具"}},[t._v("#")]),t._v(" 4.4.2.封装http工具")]),t._v(" "),s("p",[t._v("下面，我们封装一个发送Http请求的工具，基于ngx.location.capture来实现查询tomcat。")]),t._v(" "),s("p",[t._v("1）添加反向代理，到windows的Java服务")]),t._v(" "),s("p",[t._v("因为item-service中的接口都是/item开头，所以我们监听/item路径，代理到windows上的tomcat服务。")]),t._v(" "),s("p",[t._v("修改 "),s("code",[t._v("/usr/local/openresty/nginx/conf/nginx.conf")]),t._v("文件，添加一个location：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://192.168.150.1:8081")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("以后，只要我们调用"),s("code",[t._v('ngx.location.capture("/item")')]),t._v("，就一定能发送请求到windows的tomcat服务。")]),t._v(" "),s("p",[t._v("2）封装工具类")]),t._v(" "),s("p",[t._v("之前我们说过，OpenResty启动时会加载以下两个目录中的工具文件：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(671),alt:"image-20210821104857413"}})]),t._v(" "),s("p",[t._v("所以，自定义的http工具也需要放到这个目录下。")]),t._v(" "),s("p",[t._v("在"),s("code",[t._v("/usr/local/openresty/lualib")]),t._v("目录下，新建一个common.lua文件：")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /usr/local/openresty/lualib/common.lua\n")])])]),s("p",[t._v("内容如下:")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 封装函数，发送http请求，并解析响应")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("capture")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTTP_GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 记录错误信息，返回404")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http请求查询失败, path: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('", args: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 将方法导出")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" _M "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" read_http\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _M\n")])])]),s("p",[t._v("这个工具将read_http函数封装到_M这个table类型的变量中，并且返回，这类似于导出。")]),t._v(" "),s("p",[t._v("使用的时候，可以利用"),s("code",[t._v("require('common')")]),t._v("来导入该函数库，这里的common是函数库的文件名。")]),t._v(" "),s("p",[t._v("3）实现商品查询")]),t._v(" "),s("p",[t._v("最后，我们修改"),s("code",[t._v("/usr/local/openresty/lua/item.lua")]),t._v("文件，利用刚刚封装的函数库实现对tomcat的查询：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 引入自定义common工具模块，返回值是common中返回的 _M")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" common "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"common"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 从 common中获取read_http这个函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_http\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取路径参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("var"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 根据id查询商品")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" itemJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 根据id查询商品库存")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" itemStockJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/stock/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("这里查询到的结果是json字符串，并且包含商品、库存两个json字符串，页面最终需要的是把两个json拼接为一个json：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(672),alt:"image-20210821110441222"}})]),t._v(" "),s("p",[t._v("这就需要我们先把JSON变为lua的table，完成数据整合后，再转为JSON。")]),t._v(" "),s("h3",{attrs:{id:"_4-4-3-cjson工具类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-cjson工具类"}},[t._v("#")]),t._v(" 4.4.3.CJSON工具类")]),t._v(" "),s("p",[t._v("OpenResty提供了一个cjson的模块用来处理JSON的序列化和反序列化。")]),t._v(" "),s("p",[t._v("官方地址： https://github.com/openresty/lua-cjson/")]),t._v(" "),s("p",[t._v("1）引入cjson模块：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" cjson "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" require "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cjson"')]),t._v("\n")])])]),s("p",[t._v("2）序列化：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jack'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    age "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 把 table 序列化为 json")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("3）反序列化：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"name": "jack", "age": 21}\'')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 反序列化 json为 table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4-4-4-实现tomcat查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-4-实现tomcat查询"}},[t._v("#")]),t._v(" 4.4.4.实现Tomcat查询")]),t._v(" "),s("p",[t._v("下面，我们修改之前的item.lua中的业务，添加json处理功能：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入common函数库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" common "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_http\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入cjson库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" cjson "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjson'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取路径参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("var"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 根据id查询商品")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" itemJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 根据id查询商品库存")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" itemStockJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/stock/"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- JSON转化为lua的table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("itemJSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stockJSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 组合数据")]),t._v("\nitem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stock\nitem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sold "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sold\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 把item序列化为json 返回结果")]),t._v("\nngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4-4-5-基于id负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-5-基于id负载均衡"}},[t._v("#")]),t._v(" 4.4.5.基于ID负载均衡")]),t._v(" "),s("p",[t._v("刚才的代码中，我们的tomcat是单机部署。而实际开发中，tomcat一定是集群模式：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(673),alt:"image-20210821111023255"}})]),t._v(" "),s("p",[t._v("因此，OpenResty需要对tomcat集群做负载均衡。")]),t._v(" "),s("p",[t._v("而默认的负载均衡规则是轮询模式，当我们查询/item/10001时：")]),t._v(" "),s("ul",[s("li",[t._v("第一次会访问8081端口的tomcat服务，在该服务内部就形成了JVM进程缓存")]),t._v(" "),s("li",[t._v("第二次会访问8082端口的tomcat服务，该服务内部没有JVM缓存（因为JVM缓存无法共享），会查询数据库")]),t._v(" "),s("li",[t._v("...")])]),t._v(" "),s("p",[t._v("你看，因为轮询的原因，第一次查询8081形成的JVM缓存并未生效，直到下一次再次访问到8081时才可以生效，缓存命中率太低了。")]),t._v(" "),s("p",[t._v("怎么办？")]),t._v(" "),s("p",[t._v("如果能让同一个商品，每次查询时都访问同一个tomcat服务，那么JVM缓存就一定能生效了。")]),t._v(" "),s("p",[t._v("也就是说，我们需要根据商品id做负载均衡，而不是轮询。")]),t._v(" "),s("h4",{attrs:{id:"_1-原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-原理"}},[t._v("#")]),t._v(" 1）原理")]),t._v(" "),s("p",[t._v("nginx提供了基于请求路径做负载均衡的算法：")]),t._v(" "),s("p",[t._v("nginx根据请求路径做hash运算，把得到的数值对tomcat服务的数量取余，余数是几，就访问第几个服务，实现负载均衡。")]),t._v(" "),s("p",[t._v("例如：")]),t._v(" "),s("ul",[s("li",[t._v("我们的请求路径是 /item/10001")]),t._v(" "),s("li",[t._v("tomcat总数为2台（8081、8082）")]),t._v(" "),s("li",[t._v("对请求路径/item/1001做hash运算求余的结果为1")]),t._v(" "),s("li",[t._v("则访问第一个tomcat服务，也就是8081")])]),t._v(" "),s("p",[t._v("只要id不变，每次hash运算结果也不会变，那就可以保证同一个商品，一直访问同一个tomcat服务，确保JVM缓存生效。")]),t._v(" "),s("h4",{attrs:{id:"_2-实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-实现"}},[t._v("#")]),t._v(" 2）实现")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/local/openresty/nginx/conf/nginx.conf")]),t._v("文件，实现基于ID做负载均衡。")]),t._v(" "),s("p",[t._v("首先，定义tomcat集群，并设置基于路径做负载均衡：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" tomcat-cluster")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("hash")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.150.1:8081")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" 192.168.150.1:8082")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后，修改对tomcat服务的反向代理，目标指向tomcat集群：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" /item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" http://tomcat-cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("重新加载OpenResty")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),s("h4",{attrs:{id:"_3-测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试"}},[t._v("#")]),t._v(" 3）测试")]),t._v(" "),s("p",[t._v("启动两台tomcat服务：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(674),alt:"image-20210821112420464"}})]),t._v(" "),s("p",[t._v("同时启动：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(675),alt:"image-20210821112444482"}})]),t._v(" "),s("p",[t._v("清空日志后，再次访问页面，可以看到不同id的商品，访问到了不同的tomcat服务：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(676),alt:"image-20210821112559965"}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(677),alt:"image-20210821112637430"}})]),t._v(" "),s("h2",{attrs:{id:"_4-5-redis缓存预热"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-redis缓存预热"}},[t._v("#")]),t._v(" 4.5.Redis缓存预热")]),t._v(" "),s("p",[t._v("Redis缓存会面临冷启动问题：")]),t._v(" "),s("p",[s("strong",[t._v("冷启动")]),t._v("：服务刚刚启动时，Redis中并没有缓存，如果所有商品数据都在第一次查询时添加缓存，可能会给数据库带来较大压力。")]),t._v(" "),s("p",[s("strong",[t._v("缓存预热")]),t._v("：在实际开发中，我们可以利用大数据统计用户访问的热点数据，在项目启动时将这些热点数据提前查询并保存到Redis中。")]),t._v(" "),s("p",[t._v("我们数据量较少，并且没有数据统计相关功能，目前可以在启动时将所有数据都放入缓存中。")]),t._v(" "),s("p",[t._v("1）利用Docker安装Redis")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" redis "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v(":6379 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" redis redis-server "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--appendonly")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n")])])]),s("p",[t._v("2）在item-service服务中引入Redis依赖")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.boot"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-boot-starter-data-redis"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("p",[t._v("3）配置Redis地址")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.150.101\n")])])]),s("p",[t._v("4）编写初始化类")]),t._v(" "),s("p",[t._v("缓存预热需要在项目启动时完成，并且必须是拿到RedisTemplate之后。")]),t._v(" "),s("p",[t._v("这里我们利用InitializingBean接口来实现，因为InitializingBean可以在对象被Spring创建并且成员变量全部注入后执行。")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fasterxml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jackson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonProcessingException")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fasterxml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jackson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("databind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObjectMapper")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemService")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemStockService")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InitializingBean")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Autowired")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InitializingBean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemService")]),t._v(" itemService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemStockService")]),t._v(" stockService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObjectMapper")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObjectMapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("afterPropertiesSet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化缓存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.查询商品信息")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" itemList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" itemService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.放入缓存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" itemList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.1.item序列化为JSON")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeValueAsString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.2.存入redis")]),t._v("\n            redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3.查询商品库存信息")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" stockList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stockService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4.放入缓存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),t._v(" stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" stockList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.1.item序列化为JSON")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeValueAsString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.2.存入redis")]),t._v("\n            redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:stock:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-6-查询redis缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-查询redis缓存"}},[t._v("#")]),t._v(" 4.6.查询Redis缓存")]),t._v(" "),s("p",[t._v("现在，Redis缓存已经准备就绪，我们可以再OpenResty中实现查询Redis的逻辑了。如下图红框所示：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(678),alt:"image-20210821113340111"}})]),t._v(" "),s("p",[t._v("当请求进入OpenResty之后：")]),t._v(" "),s("ul",[s("li",[t._v("优先查询Redis缓存")]),t._v(" "),s("li",[t._v("如果Redis缓存未命中，再查询Tomcat")])]),t._v(" "),s("h3",{attrs:{id:"_4-6-1-封装redis工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-1-封装redis工具"}},[t._v("#")]),t._v(" 4.6.1.封装Redis工具")]),t._v(" "),s("p",[t._v("OpenResty提供了操作Redis的模块，我们只要引入该模块就能直接使用。但是为了方便，我们将Redis操作封装到之前的common.lua工具库中。")]),t._v(" "),s("p",[t._v("修改"),s("code",[t._v("/usr/local/openresty/lualib/common.lua")]),t._v("文件：")]),t._v(" "),s("p",[t._v("1）引入Redis模块，并初始化Redis对象")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入redis")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resty.redis'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 初始化redis")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" red "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nred"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_timeouts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("2）封装函数，用来释放Redis连接，其实是放入连接池")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 关闭redis连接的工具方法，其实是放入连接池")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" pool_max_idle_time "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 连接的空闲时间，单位是毫秒")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" pool_size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--连接池大小")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" ok"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_keepalive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pool_max_idle_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pool_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" ok "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"放入redis连接池失败: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("3）封装函数，根据key查询Redis数据")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询redis的方法 ip和port是redis地址，key是查询的key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取一个连接")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" ok"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" ok "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"连接redis失败 : "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询redis")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询失败处理")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"查询Redis失败: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('", key = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--得到的数据为空处理")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("null "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"查询Redis数据为空, key = "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resp\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("4）导出")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 将方法导出")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" _M "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" read_http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    read_redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" read_redis\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _M\n")])])]),s("p",[t._v("完整的common.lua：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入redis")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'resty.redis'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 初始化redis")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" red "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("new")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nred"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_timeouts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 关闭redis连接的工具方法，其实是放入连接池")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" pool_max_idle_time "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 连接的空闲时间，单位是毫秒")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" pool_size "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--连接池大小")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" ok"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_keepalive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pool_max_idle_time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pool_size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" ok "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"放入redis连接池失败: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询redis的方法 ip和port是redis地址，key是查询的key")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取一个连接")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" ok"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" port"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" ok "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"连接redis失败 : "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询redis")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询失败处理")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"查询Redis失败: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('", key = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("--得到的数据为空处理")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("null "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"查询Redis数据为空, key = "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("red"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resp\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 封装函数，发送http请求，并解析响应")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("capture")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        method "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("HTTP_GET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        args "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" resp "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 记录错误信息，返回404")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http查询失败, path: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('", args: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" resp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 将方法导出")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" _M "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  \n    read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" read_http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    read_redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" read_redis\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" _M\n")])])]),s("h3",{attrs:{id:"_4-6-2-实现redis查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-2-实现redis查询"}},[t._v("#")]),t._v(" 4.6.2.实现Redis查询")]),t._v(" "),s("p",[t._v("接下来，我们就可以去修改item.lua文件，实现对Redis的查询了。")]),t._v(" "),s("p",[t._v("查询逻辑是：")]),t._v(" "),s("ul",[s("li",[t._v("根据id查询Redis")]),t._v(" "),s("li",[t._v("如果查询失败则继续查询Tomcat")]),t._v(" "),s("li",[t._v("将查询结果返回")])]),t._v(" "),s("p",[t._v("1）修改"),s("code",[t._v("/usr/local/openresty/lua/item.lua")]),t._v("文件，添加一个查询函数：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入common函数库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" common "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_http\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_redis\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 封装查询函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询本地缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 判断查询结果")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis查询失败，尝试查询http， key: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- redis查询失败，去查询http")]),t._v("\n        val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 返回数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("2）而后修改商品查询、库存查询的业务：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(679),alt:"image-20210821114528954"}})]),t._v(" "),s("p",[t._v("3）完整的item.lua代码：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入common函数库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" common "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_http\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_redis\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入cjson库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" cjson "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjson'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 封装查询函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询本地缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 判断查询结果")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis查询失败，尝试查询http， key: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- redis查询失败，去查询http")]),t._v("\n        val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 返回数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取路径参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("var"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询商品信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" itemJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询库存信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" stockJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:stock:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/stock/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- JSON转化为lua的table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("itemJSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stockJSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 组合数据")]),t._v("\nitem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stock\nitem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sold "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sold\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 把item序列化为json 返回结果")]),t._v("\nngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"_4-7-nginx本地缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-nginx本地缓存"}},[t._v("#")]),t._v(" 4.7.Nginx本地缓存")]),t._v(" "),s("p",[t._v("现在，整个多级缓存中只差最后一环，也就是nginx的本地缓存了。如图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(680),alt:"image-20210821114742950"}})]),t._v(" "),s("h3",{attrs:{id:"_4-7-1-本地缓存api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-1-本地缓存api"}},[t._v("#")]),t._v(" 4.7.1.本地缓存API")]),t._v(" "),s("p",[t._v("OpenResty为Nginx提供了"),s("strong",[t._v("shard dict")]),t._v("的功能，可以在nginx的多个worker之间共享数据，实现缓存功能。")]),t._v(" "),s("p",[t._v("1）开启共享字典，在nginx.conf的http下添加配置：")]),t._v(" "),s("div",{staticClass:"language-nginx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 共享字典，也就是本地缓存，名称叫做：item_cache，大小150m")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token directive"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lua_shared_dict")]),t._v(" item_cache "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("150m")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n")])])]),s("p",[t._v("2）操作共享字典：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取本地缓存对象")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" item_cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item_cache\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 存储, 指定key、value、过期时间，单位s，默认为0代表永不过期")]),t._v("\nitem_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'key'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 读取")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" item_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'key'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"_4-7-2-实现本地缓存查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-2-实现本地缓存查询"}},[t._v("#")]),t._v(" 4.7.2.实现本地缓存查询")]),t._v(" "),s("p",[t._v("1）修改"),s("code",[t._v("/usr/local/openresty/lua/item.lua")]),t._v("文件，修改read_data查询函数，添加本地缓存逻辑：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入共享词典，本地缓存")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" item_cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item_cache\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 封装查询函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询本地缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" item_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"本地缓存查询失败，尝试查询Redis， key: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询redis")]),t._v("\n        val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 判断查询结果")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n            ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis查询失败，尝试查询http， key: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- redis查询失败，去查询http")]),t._v("\n            val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询成功，把数据写入本地缓存")]),t._v("\n    item_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 返回数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n")])])]),s("p",[t._v("2）修改item.lua中查询商品和库存的业务，实现最新的read_data函数：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(681),alt:"image-20210821115108528"}})]),t._v(" "),s("p",[t._v("其实就是多了缓存时间参数，过期后nginx缓存会自动删除，下次访问即可更新缓存。")]),t._v(" "),s("p",[t._v("这里给商品基本信息设置超时时间为30分钟，库存为1分钟。")]),t._v(" "),s("p",[t._v("因为库存更新频率较高，如果缓存时间过长，可能与数据库差异较大。")]),t._v(" "),s("p",[t._v("3）完整的item.lua文件：")]),t._v(" "),s("div",{staticClass:"language-lua extra-class"},[s("pre",{pre:!0,attrs:{class:"language-lua"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入common函数库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" common "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_http "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_http\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" read_redis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" common"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read_redis\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入cjson库")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" cjson "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cjson'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 导入共享词典，本地缓存")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" item_cache "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("shared"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item_cache\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 封装查询函数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询本地缓存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" item_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"本地缓存查询失败，尝试查询Redis， key: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询redis")]),t._v("\n        val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 判断查询结果")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" val "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n            ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ERR"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis查询失败，尝试查询http， key: "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- redis查询失败，去查询http")]),t._v("\n            val "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_http")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询成功，把数据写入本地缓存")]),t._v("\n    item_cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" val"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expire"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 返回数据")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" val\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("end")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 获取路径参数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("var"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询商品信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" itemJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1800")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 查询库存信息")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" stockJSON "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:stock:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/item/stock/"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("..")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("nil")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- JSON转化为lua的table")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("itemJSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("local")]),t._v(" stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("decode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stockJSON"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 组合数据")]),t._v("\nitem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stock\nitem"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sold "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sold\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("-- 把item序列化为json 返回结果")]),t._v("\nngx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("say")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cjson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h1",{attrs:{id:"_5-缓存同步"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-缓存同步"}},[t._v("#")]),t._v(" 5.缓存同步")]),t._v(" "),s("p",[t._v("大多数情况下，浏览器查询到的都是缓存数据，如果缓存数据与数据库数据存在较大差异，可能会产生比较严重的后果。")]),t._v(" "),s("p",[t._v("所以我们必须保证数据库数据、缓存数据的一致性，这就是缓存与数据库的同步。")]),t._v(" "),s("h2",{attrs:{id:"_5-1-数据同步策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-数据同步策略"}},[t._v("#")]),t._v(" 5.1.数据同步策略")]),t._v(" "),s("p",[t._v("缓存数据同步的常见方式有三种：")]),t._v(" "),s("p",[s("strong",[t._v("设置有效期")]),t._v("：给缓存设置有效期，到期后自动删除。再次查询时更新")]),t._v(" "),s("ul",[s("li",[t._v("优势：简单、方便")]),t._v(" "),s("li",[t._v("缺点：时效性差，缓存过期之前可能不一致")]),t._v(" "),s("li",[t._v("场景：更新频率较低，时效性要求低的业务")])]),t._v(" "),s("p",[s("strong",[t._v("同步双写")]),t._v("：在修改数据库的同时，直接修改缓存")]),t._v(" "),s("ul",[s("li",[t._v("优势：时效性强，缓存与数据库强一致")]),t._v(" "),s("li",[t._v("缺点：有代码侵入，耦合度高；")]),t._v(" "),s("li",[t._v("场景：对一致性、时效性要求较高的缓存数据")])]),t._v(" "),s("p",[t._v("**异步通知：**修改数据库时发送事件通知，相关服务监听到通知后修改缓存数据")]),t._v(" "),s("ul",[s("li",[t._v("优势：低耦合，可以同时通知多个缓存服务")]),t._v(" "),s("li",[t._v("缺点：时效性一般，可能存在中间不一致状态")]),t._v(" "),s("li",[t._v("场景：时效性要求一般，有多个服务需要同步")])]),t._v(" "),s("p",[t._v("而异步实现又可以基于MQ或者Canal来实现：")]),t._v(" "),s("p",[t._v("1）基于MQ的异步通知：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(682),alt:"image-20210821115552327"}})]),t._v(" "),s("p",[t._v("解读：")]),t._v(" "),s("ul",[s("li",[t._v("商品服务完成对数据的修改后，只需要发送一条消息到MQ中。")]),t._v(" "),s("li",[t._v("缓存服务监听MQ消息，然后完成对缓存的更新")])]),t._v(" "),s("p",[t._v("依然有少量的代码侵入。")]),t._v(" "),s("p",[t._v("2）基于Canal的通知")]),t._v(" "),s("p",[s("img",{attrs:{src:a(683),alt:"image-20210821115719363"}})]),t._v(" "),s("p",[t._v("解读：")]),t._v(" "),s("ul",[s("li",[t._v("商品服务完成商品修改后，业务直接结束，没有任何代码侵入")]),t._v(" "),s("li",[t._v("Canal监听MySQL变化，当发现变化后，立即通知缓存服务")]),t._v(" "),s("li",[t._v("缓存服务接收到canal通知，更新缓存")])]),t._v(" "),s("p",[t._v("代码零侵入")]),t._v(" "),s("h2",{attrs:{id:"_5-2-安装canal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-安装canal"}},[t._v("#")]),t._v(" 5.2.安装Canal")]),t._v(" "),s("h3",{attrs:{id:"_5-2-1-认识canal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1-认识canal"}},[t._v("#")]),t._v(" 5.2.1.认识Canal")]),t._v(" "),s("p",[s("strong",[t._v("Canal [kə'næl]")]),t._v("，译意为水道/管道/沟渠，canal是阿里巴巴旗下的一款开源项目，基于Java开发。基于数据库增量日志解析，提供增量数据订阅&消费。GitHub的地址：https://github.com/alibaba/canal")]),t._v(" "),s("p",[t._v("Canal是基于mysql的主从同步来实现的，MySQL主从同步的原理如下：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(684),alt:"image-20210821115914748"}})]),t._v(" "),s("ul",[s("li",[t._v("1）MySQL master 将数据变更写入二进制日志( binary log），其中记录的数据叫做binary log events")]),t._v(" "),s("li",[t._v("2）MySQL slave 将 master 的 binary log events拷贝到它的中继日志(relay log)")]),t._v(" "),s("li",[t._v("3）MySQL slave 重放 relay log 中事件，将数据变更反映它自己的数据")])]),t._v(" "),s("p",[t._v("而Canal就是把自己伪装成MySQL的一个slave节点，从而监听master的binary log变化。再把得到的变化信息通知给Canal的客户端，进而完成对其它数据库的同步。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(685),alt:"image-20210821115948395"}})]),t._v(" "),s("h3",{attrs:{id:"_5-2-2-安装canal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-2-安装canal"}},[t._v("#")]),t._v(" 5.2.2.安装Canal")]),t._v(" "),s("p",[t._v("安装和配置Canal参考课前资料文档：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(686),alt:"image-20210821120017324"}})]),t._v(" "),s("h2",{attrs:{id:"_5-3-监听canal"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-监听canal"}},[t._v("#")]),t._v(" 5.3.监听Canal")]),t._v(" "),s("p",[t._v("Canal提供了各种语言的客户端，当Canal监听到binlog变化时，会通知Canal的客户端。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(687),alt:"image-20210821120049024"}})]),t._v(" "),s("p",[t._v("我们可以利用Canal提供的Java客户端，监听Canal通知消息。当收到变化的消息时，完成对缓存的更新。")]),t._v(" "),s("p",[t._v("不过这里我们会使用GitHub上的第三方开源的canal-starter客户端。地址：https://github.com/NormanGyllenhaal/canal-client")]),t._v(" "),s("p",[t._v("与SpringBoot完美整合，自动装配，比官方客户端要简单好用很多。")]),t._v(" "),s("h3",{attrs:{id:"_5-3-1-引入依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-1-引入依赖"}},[t._v("#")]),t._v(" 5.3.1.引入依赖：")]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("top.javatool"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("canal-spring-boot-starter"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1.2.1-RELEASE"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-3-2-编写配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-2-编写配置"}},[t._v("#")]),t._v(" 5.3.2.编写配置：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("canal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("destination")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" heima "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# canal的集群名字，要与安装canal时设置的名称一致")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.150.101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11111")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# canal服务地址")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-3-3-修改item实体类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-3-修改item实体类"}},[t._v("#")]),t._v(" 5.3.3.修改Item实体类")]),t._v(" "),s("p",[t._v("通过@Id、@Column、等注解完成Item与数据库表字段的映射：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baomidou"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mybatisplus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IdType")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baomidou"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mybatisplus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TableField")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baomidou"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mybatisplus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TableId")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baomidou"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mybatisplus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TableName")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("lombok"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Data")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Id")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Transient")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("javax"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("persistence"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Column")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Data")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@TableName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tb_item"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@TableId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IdType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AUTO")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Id")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//商品id")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Column")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//商品名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" title"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//商品标题")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" price"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//价格（分）")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" image"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//商品图片")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" category"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//分类名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" brand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//品牌名称")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" spec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//规格")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" status"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//商品状态 1-正常，2-下架")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" createTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建时间")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),t._v(" updateTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//更新时间")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@TableField")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exist "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transient")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@TableField")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("exist "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Transient")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" sold"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"_5-3-4-编写监听器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-4-编写监听器"}},[t._v("#")]),t._v(" 5.3.4.编写监听器")]),t._v(" "),s("p",[t._v("通过实现"),s("code",[t._v("EntryHandler<T>")]),t._v("接口编写监听器，监听Canal消息。注意两点：")]),t._v(" "),s("ul",[s("li",[t._v("实现类通过"),s("code",[t._v('@CanalTable("tb_item")')]),t._v("指定监听的表信息")]),t._v(" "),s("li",[t._v("EntryHandler的泛型是与表对应的实体类")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("canal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("benmanes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("caffeine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisHandler")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Autowired")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("javatool"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("canal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CanalTable")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("javatool"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("canal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("handler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EntryHandler")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@CanalTable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tb_item"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EntryHandler")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisHandler")]),t._v(" redisHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cache")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" itemCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写数据到JVM进程缓存")]),t._v("\n        itemCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写数据到redis")]),t._v("\n        redisHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" before"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" after"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写数据到JVM进程缓存")]),t._v("\n        itemCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("after"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" after"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 写数据到redis")]),t._v("\n        redisHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("after"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除数据到JVM进程缓存")]),t._v("\n        itemCache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("invalidate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 删除数据到redis")]),t._v("\n        redisHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteItemById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在这里对Redis的操作都封装到了RedisHandler这个对象中，是我们之前做缓存预热时编写的一个类，内容如下：")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fasterxml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jackson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonProcessingException")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fasterxml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("jackson"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("databind"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObjectMapper")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pojo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemService")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("heima"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemStockService")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InitializingBean")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("beans"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("annotation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Autowired")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("springframework"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stereotype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token import"}},[s("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Component")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RedisHandler")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InitializingBean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringRedisTemplate")]),t._v(" redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemService")]),t._v(" itemService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Autowired")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IItemStockService")]),t._v(" stockService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObjectMapper")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ObjectMapper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("afterPropertiesSet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化缓存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1.查询商品信息")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" itemList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" itemService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.放入缓存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" item "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" itemList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.1.item序列化为JSON")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeValueAsString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.2.存入redis")]),t._v("\n            redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3.查询商品库存信息")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" stockList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" stockService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4.放入缓存")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ItemStock")]),t._v(" stock "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" stockList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.1.item序列化为JSON")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeValueAsString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2.2.存入redis")]),t._v("\n            redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:stock:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" stock"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("saveItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" json "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAPPER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeValueAsString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("opsForValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JsonProcessingException")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RuntimeException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("deleteItemById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        redisTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delete")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"item:id:"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);